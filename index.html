<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Connect - Social Network</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: #fff;
            line-height: 1.4;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 0;
            min-height: 100vh;
        }
        
        /* Sidebar Left */
        .sidebar-left {
            background: #000;
            border-right: 1px solid #2f3336;
            padding: 20px 0;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            min-width: 280px;
        }
        
        .logo {
            padding: 0 20px 20px;
            border-bottom: 1px solid #2f3336;
            margin-bottom: 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff00ff, #ff1493);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            border: 3px solid #ff00ff;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 20px rgba(255, 0, 255, 0.5); }
            50% { box-shadow: 0 0 30px rgba(255, 0, 255, 0.8); }
            100% { box-shadow: 0 0 20px rgba(255, 0, 255, 0.5); }
        }
        
        .logo-text {
            font-size: 1.8rem;
            font-weight: 900;
            background: linear-gradient(45deg, #ff00ff, #ff1493);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(255, 0, 255, 0.3);
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            margin-bottom: 5px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 20px;
            color: #fff;
            text-decoration: none;
            border-radius: 25px;
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .nav-link:hover {
            background: #1a1a1a;
        }
        
        .nav-link.active {
            font-weight: 700;
        }
        
        .nav-link i {
            font-size: 1.3rem;
            width: 24px;
        }
        
        .post-btn {
            background: #1d9bf0;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 1rem;
            margin: 20px;
            width: calc(100% - 40px);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .post-btn:hover {
            background: #1a8cd8;
        }
        
        /* Main Content */
        .main-content {
            background: #000;
            border-right: 1px solid #2f3336;
            padding: 20px;
            overflow-y: auto;
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
        }
        
        .header {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-bottom: 1px solid #2f3336;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header h1 {
            font-size: 1.3rem;
            font-weight: 700;
        }
        
        .post-composer {
            padding: 20px;
            border-bottom: 1px solid #2f3336;
        }
        
        .composer-content {
            display: flex;
            gap: 15px;
        }
        
        .composer-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(45deg, #1d9bf0, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .composer-form {
            flex: 1;
        }
        
        .composer-text {
            width: 100%;
            background: transparent;
            border: none;
            color: #fff;
            font-size: 1.2rem;
            resize: none;
            outline: none;
            min-height: 60px;
            padding: 10px 0;
        }
        
        .composer-text::placeholder {
            color: #71767b;
        }
        
        .composer-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }
        
        .composer-media {
            display: flex;
            gap: 15px;
        }
        
        .media-btn {
            background: transparent;
            border: none;
            color: #1d9bf0;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.2s;
        }
        
        .media-btn:hover {
            background: rgba(29, 155, 240, 0.1);
        }
        
        .media-btn i {
            font-size: 1.2rem;
        }
        
        .composer-submit {
            background: #1d9bf0;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .composer-submit:hover {
            background: #1a8cd8;
        }
        
        .composer-submit:disabled {
            background: #333;
            cursor: not-allowed;
        }
        
        /* Posts */
        .posts {
            background: #000;
        }
        
        .post {
            padding: 20px;
            border-bottom: 1px solid #2f3336;
            transition: all 0.2s;
        }
        
        .post:hover {
            background: #0a0a0a;
        }
        
        .post-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }
        
        .post-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(45deg, #1d9bf0, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }
        
        .post-info {
            flex: 1;
        }
        
        .post-name {
            font-weight: 700;
            margin-bottom: 2px;
        }
        
        .post-username {
            color: #71767b;
            font-size: 0.9rem;
        }
        
        .post-time {
            color: #71767b;
            font-size: 0.9rem;
        }
        
        .post-content {
            margin-bottom: 15px;
            font-size: 1.1rem;
            line-height: 1.5;
        }
        
        .post-media {
            margin-bottom: 15px;
            border-radius: 15px;
            overflow: hidden;
        }
        
        .post-media img, .post-media video {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
        }
        
        .post-actions {
            display: flex;
            justify-content: space-between;
            max-width: 425px;
        }
        
        .action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: transparent;
            border: none;
            color: #71767b;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.2s;
            font-size: 0.9rem;
        }
        
        .action-btn:hover {
            background: rgba(29, 155, 240, 0.1);
            color: #1d9bf0;
        }
        
        .action-btn.liked {
            color: #f91880;
        }
        
        .action-btn.liked:hover {
            background: rgba(249, 24, 128, 0.1);
        }
        
        .action-btn i {
            font-size: 1.1rem;
        }
        
        /* Delete buttons */
        .delete-btn {
            background: transparent;
            border: none;
            color: #dc3545;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.2s;
        }
        
        .delete-btn:hover {
            background: rgba(220, 53, 69, 0.1);
            transform: scale(1.1);
        }
        
        .delete-btn i {
            font-size: 0.9rem;
        }
        
        /* Content Sections */
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        /* Explore Section */
        .explore-content {
            padding: 20px;
        }
        
        .trending h3 {
            color: #fff;
            margin-bottom: 20px;
        }
        
        .trend-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #2f3336;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .trend-item:hover {
            background: #1a1a1a;
        }
        
        .trend-tag {
            color: #1d9bf0;
            font-weight: 600;
        }
        
        .trend-count {
            color: #71767b;
            font-size: 0.9rem;
        }
        
        /* Notifications Section */
        .notifications-content {
            padding: 20px;
        }
        
        .notification {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid #2f3336;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .notification:hover {
            background: #1a1a1a;
        }
        
        .notification i {
            color: #1d9bf0;
            font-size: 1.2rem;
        }
        
        .notification-time {
            color: #71767b;
            font-size: 0.9rem;
            margin-left: auto;
        }
        
        /* Messages Section */
        .messages-content {
            padding: 20px;
        }
        
        .message-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid #2f3336;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .message-item:hover {
            background: #1a1a1a;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
        }
        
        .message-info {
            flex: 1;
        }
        
        .message-name {
            color: #fff;
            font-weight: 600;
            display: block;
        }
        
        .message-preview {
            color: #71767b;
            font-size: 0.9rem;
        }
        
        .message-time {
            color: #71767b;
            font-size: 0.9rem;
        }
        
        /* Profile Section */
        .profile-content {
            padding: 20px;
        }
        
        .profile-info {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: #1a1a1a;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 2rem;
        }
        
        .profile-details h3 {
            color: #fff;
            margin-bottom: 5px;
        }
        
        .profile-details p {
            color: #71767b;
            margin-bottom: 5px;
        }
        
        /* More Section */
        .more-content {
            padding: 20px;
        }
        
        .more-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid #2f3336;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .more-item:hover {
            background: #1a1a1a;
        }
        
        .more-item i {
            color: #1d9bf0;
            font-size: 1.2rem;
        }
        
        .more-item span {
            color: #fff;
            font-weight: 500;
        }
        
        /* Profile Advanced Styles */
        .profile-avatar {
            position: relative;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .profile-avatar:hover {
            transform: scale(1.05);
        }
        
        .edit-overlay {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 30px;
            height: 30px;
            background: #1d9bf0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .profile-avatar:hover .edit-overlay {
            opacity: 1;
        }
        
        .profile-stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-number {
            display: block;
            font-size: 1.2rem;
            font-weight: 700;
            color: #fff;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #71767b;
        }
        
        .profile-actions {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }
        
        .profile-btn {
            padding: 10px 20px;
            border-radius: 25px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .profile-btn.primary {
            background: #1d9bf0;
            color: white;
        }
        
        .profile-btn.primary:hover {
            background: #1a8cd8;
        }
        
        .profile-btn.secondary {
            background: transparent;
            color: #1d9bf0;
            border: 1px solid #1d9bf0;
        }
        
        .profile-btn.secondary:hover {
            background: rgba(29, 155, 240, 0.1);
        }
        
        .profile-tabs {
            display: flex;
            border-bottom: 1px solid #2f3336;
            margin: 20px 0;
        }
        
        .tab-btn {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            color: #71767b;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .tab-btn.active {
            color: #1d9bf0;
            border-bottom: 2px solid #1d9bf0;
        }
        
        .tab-btn:hover {
            background: #1a1a1a;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            padding: 20px;
        }
        
        .media-item {
            aspect-ratio: 1;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .media-item:hover {
            transform: scale(1.02);
        }
        
        .media-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .liked-posts {
            padding: 20px;
            text-align: center;
            color: #71767b;
        }
        
        /* More Section Advanced */
        .more-section {
            margin-bottom: 30px;
        }
        
        .more-section h3 {
            color: #fff;
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-left: 10px;
        }
        
        .more-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid #2f3336;
            cursor: pointer;
            transition: background 0.2s;
            position: relative;
        }
        
        .more-item:hover {
            background: #1a1a1a;
        }
        
        .more-item i:last-child {
            margin-left: auto;
            color: #71767b;
            font-size: 0.8rem;
        }
        
        /* Authentication Styles */
        .auth-modal {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            background: linear-gradient(135deg, #000 0%, #1a1a1a 100%) !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            z-index: 99999 !important;
        }
        
        .auth-container {
            background: #1a1a1a;
            border-radius: 20px;
            padding: 40px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            border: 1px solid #2f3336;
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .auth-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .auth-logo .logo-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff00ff, #ff1493);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
            font-weight: bold;
            border: 3px solid #ff00ff;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
            animation: pulse 2s infinite;
        }
        
        .auth-logo .logo-text {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(45deg, #ff00ff, #ff1493);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .auth-form h2 {
            color: #fff;
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            color: #fff;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .form-group input {
            width: 100%;
            padding: 15px;
            background: #333;
            border: 1px solid #555;
            border-radius: 10px;
            color: #fff;
            font-size: 1rem;
            transition: all 0.2s;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #1d9bf0;
            box-shadow: 0 0 0 2px rgba(29, 155, 240, 0.2);
        }
        
        .form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #ccc;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .checkbox-label input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        
        .forgot-link {
            color: #1d9bf0;
            text-decoration: none;
            font-size: 0.9rem;
        }
        
        .forgot-link:hover {
            text-decoration: underline;
        }
        
        .auth-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .auth-btn.primary {
            background: #1d9bf0;
            color: white;
        }
        
        .auth-btn.primary:hover {
            background: #1a8cd8;
            transform: translateY(-2px);
        }
        
        .auth-switch {
            text-align: center;
            margin-top: 25px;
        }
        
        .auth-switch p {
            color: #ccc;
            font-size: 0.9rem;
        }
        
        .auth-switch a {
            color: #1d9bf0;
            text-decoration: none;
            font-weight: 600;
        }
        
        .auth-switch a:hover {
            text-decoration: underline;
        }
        
        /* Main App Hidden Initially */
        #mainApp {
            display: none;
        }
        
        #mainApp.show {
            display: grid;
        }
        
        /* Comments */
        .comments {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #2f3336;
        }
        
        .comment {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, #1d9bf0, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        
        .comment-content {
            flex: 1;
        }
        
        .comment-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }
        
        .comment-name {
            font-weight: 700;
            font-size: 0.9rem;
        }
        
        .comment-time {
            color: #71767b;
            font-size: 0.8rem;
        }
        
        .comment-text {
            font-size: 0.95rem;
            line-height: 1.4;
        }
        
        .comment-input {
            display: flex;
            gap: 12px;
            margin-top: 10px;
        }
        
        .comment-input input {
            flex: 1;
            background: #1a1a1a;
            border: 1px solid #2f3336;
            border-radius: 20px;
            padding: 10px 15px;
            color: #fff;
            outline: none;
            font-size: 0.9rem;
        }
        
        .comment-input input::placeholder {
            color: #71767b;
        }
        
        .comment-submit {
            background: #1d9bf0;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .comment-submit:hover {
            background: #1a8cd8;
        }
        
        /* Sidebar Right */
        .sidebar-right {
            background: #000;
            padding: 20px;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            min-width: 350px;
        }
        
        .search-box {
            background: #1a1a1a;
            border: 1px solid #2f3336;
            border-radius: 25px;
            padding: 12px 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .search-box input {
            background: transparent;
            border: none;
            color: #fff;
            outline: none;
            flex: 1;
        }
        
        .search-box input::placeholder {
            color: #71767b;
        }
        
        /* Search Section */
        .search-content {
            padding: 20px;
        }
        
        .search-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #2f3336;
        }
        
        .search-tab {
            background: transparent;
            border: none;
            color: #71767b;
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .search-tab.active {
            color: #1d9bf0;
            border-bottom-color: #1d9bf0;
        }
        
        .search-tab:hover {
            color: #fff;
        }
        
        .search-tab-content {
            display: none;
        }
        
        .search-tab-content.active {
            display: block;
        }
        
        .search-result-item {
            background: #1a1a1a;
            border: 1px solid #2f3336;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .search-result-item:hover {
            background: #262626;
        }
        
        .user-search-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #1a1a1a;
            border: 1px solid #2f3336;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .user-search-item:hover {
            background: #262626;
        }
        
        .user-search-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #71767b;
            font-size: 1.2rem;
        }
        
        .user-search-info {
            flex: 1;
        }
        
        .user-search-name {
            color: #fff;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .user-search-username {
            color: #71767b;
            font-size: 0.9rem;
        }
        
        .hashtag-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #1a1a1a;
            border: 1px solid #2f3336;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .hashtag-item:hover {
            background: #262626;
        }
        
        .hashtag-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #1d9bf0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 1.2rem;
        }
        
        .hashtag-info {
            flex: 1;
        }
        
        .hashtag-name {
            color: #1d9bf0;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .hashtag-count {
            color: #71767b;
            font-size: 0.9rem;
        }
        
        .trending {
            background: #1a1a1a;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .trending h3 {
            font-size: 1.2rem;
            margin-bottom: 15px;
        }
        
        .trend-item {
            padding: 10px 0;
            border-bottom: 1px solid #2f3336;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .trend-item:hover {
            background: #0a0a0a;
            margin: 0 -10px;
            padding: 10px;
            border-radius: 8px;
        }
        
        .trend-item:last-child {
            border-bottom: none;
        }
        
        .trend-topic {
            font-weight: 700;
            margin-bottom: 2px;
        }
        
        .trend-count {
            color: #71767b;
            font-size: 0.9rem;
        }
        
        .who-to-follow {
            background: #1a1a1a;
            border-radius: 15px;
            padding: 20px;
        }
        
        .who-to-follow h3 {
            font-size: 1.2rem;
            margin-bottom: 15px;
        }
        
        .follow-user {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 0;
            border-bottom: 1px solid #2f3336;
        }
        
        .follow-user:last-child {
            border-bottom: none;
        }
        
        .follow-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #1d9bf0, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
        }
        
        .follow-info {
            flex: 1;
        }
        
        .follow-name {
            font-weight: 700;
            margin-bottom: 2px;
        }
        
        .follow-username {
            color: #71767b;
            font-size: 0.9rem;
        }
        
        .follow-btn {
            background: #000;
            color: #fff;
            border: 1px solid #2f3336;
            padding: 6px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .follow-btn:hover {
            background: #1a1a1a;
        }
        
        /* Desktop Layout - Default */
        .container {
            display: grid;
            grid-template-columns: 280px 1fr 350px;
            gap: 0;
            min-height: 100vh;
            width: 100%;
            margin: 0;
            padding: 0;
        }
        
        /* Force desktop layout on large screens */
        @media (min-width: 769px) {
            .mobile-header,
            .mobile-menu,
            .mobile-menu-overlay,
            .mobile-post-btn {
                display: none !important;
            }
            
            .container {
                display: grid !important;
                grid-template-columns: 280px 1fr 350px !important;
            }
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 80px 1fr 300px;
            }
            
            .sidebar-left .nav-link span {
                display: none;
            }
            
            .sidebar-left .post-btn {
                display: none;
            }
        }
        
        /* Tablet specific styles */
        @media (max-width: 1024px) and (min-width: 769px) {
            .mobile-header {
                display: none;
            }
            
            .mobile-menu {
                display: none;
            }
            
            .mobile-post-btn {
                display: none;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .post {
                margin-bottom: 20px;
                padding: 20px;
            }
            
            .post-header {
                gap: 15px;
            }
            
            .post-avatar {
                width: 50px;
                height: 50px;
            }
            
            .post-content {
                font-size: 16px;
                line-height: 1.5;
            }
            
            .post-actions {
                gap: 20px;
            }
            
            .post-action {
                padding: 8px 12px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                gap: 0;
                padding: 0;
            }
            
            .sidebar-left, .sidebar-right {
                display: none;
            }
            
            .main-content {
                margin: 0;
                padding: 10px;
                width: 100%;
                max-width: 100%;
            }
            
            /* Mobile Header - Hidden by default */
            .mobile-header {
                display: none !important;
            }
            
            /* Show mobile header only on mobile */
            @media (max-width: 768px) {
                .mobile-header {
                    display: flex !important;
                    justify-content: space-between;
                    align-items: center;
                    padding: 15px 20px;
                    background: #000;
                    border-bottom: 1px solid #2f3336;
                    position: sticky;
                    top: 0;
                    z-index: 1000;
                }
            }
            
            .mobile-logo {
                display: flex;
                align-items: center;
                gap: 10px;
                color: #fff;
                font-weight: bold;
                font-size: 18px;
            }
            
            .mobile-logo-icon {
                width: 32px;
                height: 32px;
                background: linear-gradient(45deg, #ff0080, #ff8c00);
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: #fff;
                font-weight: bold;
                font-size: 18px;
            }
            
            .mobile-menu-btn {
                background: none;
                border: none;
                color: #fff;
                font-size: 24px;
                cursor: pointer;
                padding: 8px;
                border-radius: 8px;
                transition: background 0.3s;
            }
            
            .mobile-menu-btn:hover {
                background: #2f3336;
            }
            
            /* Mobile Menu - Hidden by default */
            .mobile-menu {
                display: none !important;
            }
            
            /* Show mobile menu only on mobile */
            @media (max-width: 768px) {
                .mobile-menu {
                    display: block !important;
                    position: fixed;
                    top: 0;
                    left: -100%;
                    width: 280px;
                    height: 100vh;
                    background: #000;
                    border-right: 1px solid #2f3336;
                    z-index: 1001;
                    transition: left 0.3s ease;
                    overflow-y: auto;
                }
            }
            
            .mobile-menu.active {
                left: 0;
            }
            
            .mobile-menu-header {
                padding: 20px;
                border-bottom: 1px solid #2f3336;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .mobile-menu-close {
                background: none;
                border: none;
                color: #fff;
                font-size: 24px;
                cursor: pointer;
                padding: 8px;
                border-radius: 8px;
                transition: background 0.3s;
            }
            
            .mobile-menu-close:hover {
                background: #2f3336;
            }
            
            .mobile-menu-content {
                padding: 20px 0;
            }
            
            .mobile-nav-item {
                display: block;
                padding: 15px 20px;
                color: #fff;
                text-decoration: none;
                border-bottom: 1px solid #2f3336;
                transition: background 0.3s;
            }
            
            .mobile-nav-item:hover {
                background: #2f3336;
            }
            
            .mobile-nav-item i {
                margin-right: 15px;
                width: 20px;
            }
            
            .mobile-users-section {
                border-top: 1px solid #2f3336;
                margin-top: 10px;
            }
            
            .mobile-user-item {
                display: flex;
                align-items: center;
                padding: 10px 20px;
                border-bottom: 1px solid #2f3336;
                color: #fff;
            }
            
            .mobile-user-avatar {
                width: 35px;
                height: 35px;
                border-radius: 50%;
                background: #1a8cd8;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-right: 10px;
                font-size: 14px;
            }
            
            .mobile-user-info {
                flex: 1;
            }
            
            .mobile-user-name {
                font-weight: 600;
                font-size: 14px;
                margin-bottom: 2px;
            }
            
            .mobile-user-username {
                color: #71767b;
                font-size: 12px;
            }
            
            .mobile-user-actions {
                display: flex;
                gap: 5px;
            }
            
            .mobile-follow-btn, .mobile-message-btn {
                background: #1a8cd8;
                color: white;
                border: none;
                padding: 6px 10px;
                border-radius: 15px;
                cursor: pointer;
                font-size: 11px;
            }
            
            .mobile-message-btn {
                background: #17bf63;
            }
            
            /* Mobile Menu Overlay - Hidden by default */
            .mobile-menu-overlay {
                display: none !important;
            }
            
            /* Show mobile menu overlay only on mobile */
            @media (max-width: 768px) {
                .mobile-menu-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.5);
                    z-index: 1000;
                    display: none;
                }
            }
            
            .mobile-menu-overlay.active {
                display: block;
            }
            
            /* Mobile Post Button - Hidden by default */
            .mobile-post-btn {
                display: none !important;
            }
            
            /* Show mobile post button only on mobile */
            @media (max-width: 768px) {
                .mobile-post-btn {
                    display: block !important;
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    width: 56px;
                    height: 56px;
                    background: linear-gradient(45deg, #ff0080, #ff8c00);
                    border: none;
                    border-radius: 50%;
                    color: #fff;
                    font-size: 24px;
                    cursor: pointer;
                    box-shadow: 0 4px 12px rgba(255, 0, 128, 0.3);
                    transition: transform 0.3s, box-shadow 0.3s;
                    z-index: 999;
                }
            }
            
            .mobile-post-btn:hover {
                transform: scale(1.1);
                box-shadow: 0 6px 16px rgba(255, 0, 128, 0.4);
            }
            
            /* Mobile Content */
            .mobile-content {
                padding-top: 80px;
                padding-bottom: 100px;
            }
            
            .post {
                margin-bottom: 15px;
                padding: 15px;
            }
            
            .post-header {
                gap: 10px;
            }
            
            .post-avatar {
                width: 40px;
                height: 40px;
            }
            
            .post-actions {
                gap: 15px;
            }
            
            .post-actions button {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            
            .comment-input {
                flex-direction: column;
                gap: 10px;
            }
            
            .comment-input input {
                width: 100%;
            }
            
            .comment-submit {
                width: 100%;
            }
        }
        
        /* Mobile landscape */
        @media (max-width: 768px) and (orientation: landscape) {
            .main-content {
                padding: 5px;
            }
            
            .post {
                padding: 10px;
            }
        }
        
        /* Mobile portrait */
        @media (max-width: 480px) {
            .main-content {
                padding: 5px;
            }
            
            .post {
                padding: 10px;
                margin-bottom: 10px;
            }
            
            .post-header {
                gap: 8px;
            }
            
            .post-avatar {
                width: 35px;
                height: 35px;
            }
            
            .post-actions {
                gap: 10px;
            }
            
            .post-actions button {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .post {
            animation: fadeIn 0.3s ease;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #1d9bf0;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
    </style>
</head>
<body>
    <!-- Login/Register Modal -->
    <div id="authModal" class="auth-modal" style="display: flex;">
        <div class="auth-container">
            <div class="auth-header">
                <div class="auth-logo">
                    <div class="logo-icon">C</div>
                    <div class="logo-text">CONNECT</div>
                </div>
            </div>
            
            <!-- Login Form -->
            <div id="loginForm" class="auth-form active">
                <h2>Accedi al tuo account</h2>
                <form onsubmit="handleLogin(event)" id="loginFormElement">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" placeholder="Inserisci la tua email" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" placeholder="Inserisci la tua password" required>
                    </div>
                    <div class="form-options">
                        <label class="checkbox-label">
                            <input type="checkbox" id="rememberMe">
                            <span class="checkmark"></span>
                            Ricordami
                        </label>
                        <a href="#" onclick="showForgotPassword(); return false;" class="forgot-link">Password dimenticata?</a>
                    </div>
                    <button type="submit" class="auth-btn primary">
                        <i class="fas fa-sign-in-alt"></i>
                        Accedi
                    </button>
                    
                    <!-- Test Connection Button for Mobile -->
                    <button type="button" onclick="testConnection()" class="auth-btn secondary" style="margin-top: 10px; background: #17bf63;">
                        <i class="fas fa-wifi"></i>
                        Test Connessione
                    </button>
                    
                    <!-- Test Load Posts Button -->
                    <button type="button" onclick="loadAllPostsForHome()" class="auth-btn secondary" style="margin-top: 10px; background: #1a8cd8;">
                        <i class="fas fa-refresh"></i>
                        Test Carica Post
                    </button>
                </form>
                <div class="auth-switch">
                    <p>Non hai un account? <a href="#" onclick="showRegister(); return false;">Registrati</a></p>
                </div>
            </div>
            
            <!-- Register Form -->
            <div id="registerForm" class="auth-form">
                <h2>Crea il tuo account</h2>
                <form onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label for="registerName">Nome completo</label>
                        <input type="text" id="registerName" placeholder="Inserisci il tuo nome" required>
                    </div>
                    <div class="form-group">
                        <label for="registerUsername">Username</label>
                        <input type="text" id="registerUsername" placeholder="Scegli un username" required>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email</label>
                        <input type="email" id="registerEmail" placeholder="Inserisci la tua email" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <input type="password" id="registerPassword" placeholder="Crea una password" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Conferma Password</label>
                        <input type="password" id="confirmPassword" placeholder="Conferma la password" required>
                    </div>
                    <div class="form-options">
                        <label class="checkbox-label">
                            <input type="checkbox" id="acceptTerms" required>
                            <span class="checkmark"></span>
                            Accetto i <a href="#" onclick="showTerms()">Termini di Servizio</a>
                        </label>
                    </div>
                    <button type="submit" class="auth-btn primary">
                        <i class="fas fa-user-plus"></i>
                        Registrati
                    </button>
                </form>
                <div class="auth-switch">
                    <p>Hai già un account? <a href="#" onclick="showLogin(); return false;">Accedi</a></p>
                </div>
            </div>
            
            <!-- Forgot Password Form -->
            <div id="forgotPasswordForm" class="auth-form">
                <h2>Password dimenticata</h2>
                <form onsubmit="handleForgotPassword(event)">
                    <div class="form-group">
                        <label for="forgotEmail">Email</label>
                        <input type="email" id="forgotEmail" placeholder="Inserisci la tua email" required>
                    </div>
                    <button type="submit" class="auth-btn primary">
                        <i class="fas fa-envelope"></i>
                        Invia reset
                    </button>
                </form>
                <div class="auth-switch">
                    <p><a href="#" onclick="showLogin(); return false;">Torna al login</a></p>
                </div>
            </div>
        </div>
    </div>

    <div class="container" id="mainApp" style="display: none;">
        <!-- Mobile Header -->
        <div class="mobile-header">
            <div class="mobile-logo">
                <div class="mobile-logo-icon">C</div>
                <span>CONNECT</span>
            </div>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        
        <!-- Mobile Menu -->
        <div class="mobile-menu" id="mobileMenu">
            <div class="mobile-menu-header">
                <div class="mobile-logo">
                    <div class="mobile-logo-icon">C</div>
                    <span>CONNECT</span>
                </div>
                <button class="mobile-menu-close" onclick="toggleMobileMenu()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mobile-menu-content">
                <a href="#" class="mobile-nav-item" onclick="showSection('home'); toggleMobileMenu();">
                    <i class="fas fa-home"></i>
                    Home
                </a>
                <a href="#" class="mobile-nav-item" onclick="showSection('explore'); toggleMobileMenu();">
                    <i class="fas fa-hashtag"></i>
                    Esplora
                </a>
                <a href="#" class="mobile-nav-item" onclick="showSection('notifications'); toggleMobileMenu();">
                    <i class="fas fa-bell"></i>
                    Notifiche
                </a>
                <a href="#" class="mobile-nav-item" onclick="showSection('messages'); toggleMobileMenu();">
                    <i class="fas fa-envelope"></i>
                    Messaggi
                </a>
                <a href="#" class="mobile-nav-item" onclick="showSection('bookmarks'); toggleMobileMenu();">
                    <i class="fas fa-bookmark"></i>
                    Segnalibri
                </a>
                <a href="#" class="mobile-nav-item" onclick="showSection('lists'); toggleMobileMenu();">
                    <i class="fas fa-list"></i>
                    Liste
                </a>
                <a href="#" class="mobile-nav-item" onclick="showSection('profile'); toggleMobileMenu();">
                    <i class="fas fa-user"></i>
                    Profilo
                </a>
                <a href="#" class="mobile-nav-item" onclick="showSection('more'); toggleMobileMenu();">
                    <i class="fas fa-ellipsis-h"></i>
                    Altro
                </a>
                
                <!-- Utenti Online per Mobile -->
                <div class="mobile-users-section">
                    <h3 style="color: #fff; padding: 15px 20px; margin: 0; border-bottom: 1px solid #2f3336; font-size: 16px;">
                        👥 Utenti Online
                    </h3>
                    <div id="mobileUsersList" style="max-height: 200px; overflow-y: auto;">
                        <!-- Utenti online verranno mostrati qui -->
                    </div>
                    <div class="mobile-no-users-message" style="color: #71767b; text-align: center; padding: 20px; display: none;">
                        <p>Nessun utente online al momento</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu Overlay -->
        <div class="mobile-menu-overlay" id="mobileMenuOverlay" onclick="toggleMobileMenu()"></div>
        
        <!-- Mobile Post Button -->
        <button class="mobile-post-btn" onclick="showPostModal()">
            <i class="fas fa-plus"></i>
        </button>
        
        <!-- Sidebar Left -->
        <div class="sidebar-left">
            <div class="logo">
                <div class="logo-icon">C</div>
                <div class="logo-text">CONNECT</div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" onclick="showSection('home')">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('explore')">
                        <i class="fas fa-hashtag"></i>
                        <span>Esplora</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('notifications')">
                        <i class="fas fa-bell"></i>
                        <span>Notifiche</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('messages')">
                        <i class="fas fa-envelope"></i>
                        <span>Messaggi</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('bookmarks')">
                        <i class="fas fa-bookmark"></i>
                        <span>Segnalibri</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('lists')">
                        <i class="fas fa-list"></i>
                        <span>Liste</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('profile')">
                        <i class="fas fa-user"></i>
                        <span>Profilo</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('more')">
                        <i class="fas fa-ellipsis-h"></i>
                        <span>Altro</span>
                    </a>
                </li>
            </ul>
            
            <button class="post-btn" onclick="showPostModal()">
                <i class="fas fa-feather-alt"></i>
                <span>Posta</span>
            </button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Home Section -->
            <div id="home-section" class="content-section active">
                <div class="header">
                    <h1>Home</h1>
                </div>
                
                <!-- Post Composer -->
                <div class="post-composer">
                    <div class="composer-content">
                        <div class="composer-avatar" onclick="changeProfilePic()">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="composer-form">
                            <textarea class="composer-text" placeholder="Cosa sta succedendo?" id="postText"></textarea>
                            <div class="composer-actions">
                                <div class="composer-media">
                                    <button class="media-btn" onclick="addPhoto()" title="Aggiungi foto">
                                        <i class="fas fa-image"></i>
                                    </button>
                                    <button class="media-btn" onclick="addVideo()" title="Aggiungi video">
                                        <i class="fas fa-video"></i>
                                    </button>
                                    <button class="media-btn" onclick="addGif()" title="Aggiungi GIF">
                                        <i class="fas fa-smile"></i>
                                    </button>
                                    <button class="media-btn" onclick="addPoll()" title="Aggiungi sondaggio">
                                        <i class="fas fa-poll"></i>
                                    </button>
                                </div>
                                <button class="composer-submit" onclick="createPost()" id="submitBtn">
                                    Posta
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Posts Feed -->
                <div class="posts" id="posts">
                    <!-- Posts will be populated here -->
                </div>
            </div>

            <!-- Explore Section -->
            <div id="explore-section" class="content-section">
                <div class="header">
                    <h1>Esplora</h1>
                </div>
                <div class="explore-content">
                    <div class="trending">
                        <h3>🔥 Tendenze</h3>
                        <div class="trend-item">
                            <span class="trend-tag">#Connect</span>
                            <span class="trend-count">1.2K post</span>
                        </div>
                        <div class="trend-item">
                            <span class="trend-tag">#Social</span>
                            <span class="trend-count">856 post</span>
                        </div>
                        <div class="trend-item">
                            <span class="trend-tag">#Tech</span>
                            <span class="trend-count">643 post</span>
                        </div>
                    </div>
                    
                    <div class="explore-posts">
                        <h3>📱 Tutti i Post</h3>
                        <div id="explorePosts" class="posts">
                            <!-- Posts will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notifications Section -->
            <div id="notifications-section" class="content-section">
                <div class="header">
                    <h1>Notifiche</h1>
                </div>
                <div class="notifications-content">
                    <div class="notification">
                        <i class="fas fa-heart"></i>
                        <span>Mario Rossi ha messo like al tuo post</span>
                        <span class="notification-time">2m</span>
                    </div>
                    <div class="notification">
                        <i class="fas fa-comment"></i>
                        <span>Giulia Bianchi ha commentato il tuo post</span>
                        <span class="notification-time">5m</span>
                    </div>
                </div>
            </div>

            <!-- Messages Section -->
            <div id="messages-section" class="content-section">
                <div class="header">
                    <h1>Messaggi</h1>
                </div>
                <div class="messages-content">
                    <div id="messagesList">
                        <!-- I messaggi reali verranno caricati qui -->
                    </div>
                    <div class="no-messages-message" style="color: #71767b; text-align: center; padding: 40px;">
                        <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                        <h3>Nessun messaggio</h3>
                        <p>I tuoi messaggi appariranno qui quando qualcuno ti scriverà</p>
                    </div>
                </div>
            </div>

            <!-- Bookmarks Section -->
            <div id="bookmarks-section" class="content-section">
                <div class="header">
                    <h1>Segnalibri</h1>
                </div>
                <div class="bookmarks-content">
                    <p>I tuoi post salvati appariranno qui</p>
                </div>
            </div>

            <!-- Lists Section -->
            <div id="lists-section" class="content-section">
                <div class="header">
                    <h1>Liste</h1>
                </div>
                <div class="lists-content">
                    <p>Le tue liste personalizzate</p>
                </div>
            </div>

            <!-- Profile Section -->
            <div id="profile-section" class="content-section">
                <div class="header">
                    <h1>Profilo</h1>
                </div>
                <div class="profile-content">
                    <div class="profile-info">
                        <div class="profile-avatar" onclick="changeProfilePicture()">
                            <i class="fas fa-user"></i>
                            <div class="edit-overlay">
                                <i class="fas fa-camera"></i>
                            </div>
                        </div>
                        <div class="profile-details">
                            <h3 id="profileName">Fabio</h3>
                            <p id="profileUsername">@fabio75</p>
                            <p id="profileBio">Sono un Programmatore informatico di Roma, sono molto appassionato nel campo dell'informatica e creo siti web e web app per sicurezza informatica.</p>
                            <div class="profile-stats">
                                <div class="stat">
                                    <span class="stat-number">0</span>
                                    <span class="stat-label">Post</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-number">0</span>
                                    <span class="stat-label">Follower</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-number">0</span>
                                    <span class="stat-label">Following</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-actions">
                        <button class="profile-btn primary" onclick="editProfile()">
                            <i class="fas fa-edit"></i>
                            Modifica Profilo
                        </button>
                        <button class="profile-btn secondary" onclick="showSettings()">
                            <i class="fas fa-cog"></i>
                            Impostazioni
                        </button>
                        <button class="profile-btn danger" onclick="showDeleteAccount()" style="background: #dc3545; color: white;">
                            <i class="fas fa-trash"></i>
                            Elimina Account
                        </button>
                    </div>
                    
                    <div class="profile-tabs">
                        <button class="tab-btn active" onclick="showProfileTab('posts')">
                            <i class="fas fa-th-large"></i>
                            Post
                        </button>
                        <button class="tab-btn" onclick="showProfileTab('media')">
                            <i class="fas fa-photo-video"></i>
                            Media
                        </button>
                        <button class="tab-btn" onclick="showProfileTab('likes')">
                            <i class="fas fa-heart"></i>
                            Mi piace
                        </button>
                    </div>
                    
                    <div class="profile-tab-content">
                        <div id="profile-posts" class="tab-content active">
                            <div class="posts" id="profilePosts">
                                <!-- User posts will be populated here -->
                            </div>
                        </div>
                        <div id="profile-media" class="tab-content">
                            <div class="media-grid">
                                <div class="media-item">
                                    <div style="width: 200px; height: 200px; background: #333; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #71767b;">
                                        <i class="fas fa-image" style="font-size: 2rem;"></i>
                                    </div>
                                </div>
                                <div class="media-item">
                                    <div style="width: 200px; height: 200px; background: #333; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #71767b;">
                                        <i class="fas fa-video" style="font-size: 2rem;"></i>
                                    </div>
                                </div>
                                <div class="media-item">
                                    <div style="width: 200px; height: 200px; background: #333; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #71767b;">
                                        <i class="fas fa-photo-video" style="font-size: 2rem;"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="profile-likes" class="tab-content">
                            <div class="liked-posts">
                                <p>I post che ti sono piaciuti appariranno qui</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search Section -->
            <div id="search-section" class="content-section">
                <div class="header">
                    <h1>Ricerca</h1>
                </div>
                <div class="search-content">
                    <div class="search-results" id="searchResults">
                        <div class="search-tabs">
                            <button class="search-tab active" onclick="showSearchTab('posts')">Post</button>
                            <button class="search-tab" onclick="showSearchTab('users')">Utenti</button>
                            <button class="search-tab" onclick="showSearchTab('hashtags')">Hashtag</button>
                        </div>
                        <div id="search-posts" class="search-tab-content active">
                            <div class="posts" id="searchPosts">
                                <!-- Search results will be populated here -->
                            </div>
                        </div>
                        <div id="search-users" class="search-tab-content">
                            <div class="users" id="searchUsers">
                                <!-- User search results will be populated here -->
                            </div>
                        </div>
                        <div id="search-hashtags" class="search-tab-content">
                            <div class="hashtags" id="searchHashtags">
                                <!-- Hashtag search results will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- More Section -->
            <div id="more-section" class="content-section">
                <div class="header">
                    <h1>Altro</h1>
                </div>
                <div class="more-content">
                    <div class="more-section">
                        <h3>Account</h3>
                        <div class="more-item" onclick="showSettings()">
                            <i class="fas fa-cog"></i>
                            <span>Impostazioni</span>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="more-item" onclick="showPrivacy()">
                            <i class="fas fa-shield-alt"></i>
                            <span>Privacy e Sicurezza</span>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="more-item" onclick="showNotifications()">
                            <i class="fas fa-bell"></i>
                            <span>Notifiche</span>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                    
                    <div class="more-section">
                        <h3>Supporto</h3>
                        <div class="more-item" onclick="showHelp()">
                            <i class="fas fa-question-circle"></i>
                            <span>Aiuto e Supporto</span>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="more-item" onclick="showContact()">
                            <i class="fas fa-envelope"></i>
                            <span>Contattaci</span>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="more-item" onclick="showReport()">
                            <i class="fas fa-flag"></i>
                            <span>Segnala un Problema</span>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                    
                    <div class="more-section">
                        <h3>Informazioni</h3>
                        <div class="more-item" onclick="showAbout()">
                            <i class="fas fa-info-circle"></i>
                            <span>Informazioni</span>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="more-item" onclick="showTerms()">
                            <i class="fas fa-file-contract"></i>
                            <span>Termini di Servizio</span>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="more-item" onclick="showPrivacyPolicy()">
                            <i class="fas fa-user-shield"></i>
                            <span>Privacy Policy</span>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                    
                    <div class="more-section">
                        <h3>Account</h3>
                        <div class="more-item" onclick="showLogout()">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Esci</span>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar Right -->
        <div class="sidebar-right">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Cerca su Connect" onkeypress="handleSearchKeypress(event)">
            </div>
            
            <div class="trending">
                <h3>Trending in Italia</h3>
                <div class="trend-item">
                    <div class="trend-topic">#Connect</div>
                    <div class="trend-count">12.5K post</div>
                </div>
                <div class="trend-item">
                    <div class="trend-topic">#SocialNetwork</div>
                    <div class="trend-count">8.2K post</div>
                </div>
                <div class="trend-item">
                    <div class="trend-topic">#Tech</div>
                    <div class="trend-count">15.1K post</div>
                </div>
                <div class="trend-item">
                    <div class="trend-topic">#Innovation</div>
                    <div class="trend-count">6.8K post</div>
                </div>
            </div>
            
            <div class="who-to-follow">
                <h3>Chi seguire <button onclick="loadRealUsers()" style="background: #1a8cd8; color: white; border: none; padding: 4px 8px; border-radius: 12px; cursor: pointer; font-size: 12px; margin-left: 10px;">🔄</button></h3>
                <div id="realUsersList">
                    <!-- Solo utenti reali verranno mostrati qui -->
                </div>
                <div class="no-users-message" style="color: #71767b; text-align: center; padding: 20px;">
                    <p>Nessun utente online al momento</p>
                    <p style="font-size: 12px; margin-top: 5px;">Gli utenti reali appariranno qui quando si registreranno</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Test immediate execution
        console.log('Script loading...');
        
        // Global variables
        let posts = [];
        let currentUser = {
            name: "Fabio",
            username: "fabio75",
            avatar: "fas fa-user",
            online: true
        };
        
        // Test syntax
        try {
            console.log('JavaScript syntax OK');
        } catch (error) {
            console.error('JavaScript syntax error:', error);
        }
        
        // Test function
        function testFunction() {
            console.log('Test function called!');
            alert('Test function works!');
        }
        
        // Make test function global immediately
        window.testFunction = testFunction;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded!');
            
            // Check authentication first
            checkAuth();
            
            // Initialize app components
            loadPosts();
            renderPosts();
            updateTime();
            
            // Debug upload
            console.log('Connect Social Network inizializzato');
            console.log('Funzioni disponibili:', {
                showLogin: typeof showLogin,
                showRegister: typeof showRegister,
                showForgotPassword: typeof showForgotPassword,
                handleLogin: typeof handleLogin,
                handleRegister: typeof handleRegister
            });
            
            // Test functions
            console.log('Test functions:');
            console.log('window.showLogin:', typeof window.showLogin);
            console.log('window.showRegister:', typeof window.showRegister);
            console.log('window.handleLogin:', typeof window.handleLogin);
            console.log('window.handleRegister:', typeof window.handleRegister);
            
            // Test DOM elements
            console.log('DOM Elements:');
            console.log('loginForm:', document.getElementById('loginForm'));
            console.log('registerForm:', document.getElementById('registerForm'));
            console.log('loginEmail:', document.getElementById('loginEmail'));
            console.log('registerName:', document.getElementById('registerName'));
            console.log('Funzioni disponibili:', {
                addPhoto: typeof addPhoto,
                addVideo: typeof addVideo,
                createPost: typeof createPost
            });
        });

        // Load posts from localStorage
        function loadPosts() {
            const savedPosts = localStorage.getItem('connectPosts');
            if (savedPosts) {
                posts = JSON.parse(savedPosts);
                renderPosts();
            }
        }
        
        // Load all posts (not just user-specific)
        async function loadAllPosts() {
            // Try to load from database first
            try {
                const response = await fetch('/api/posts');
                if (response.ok) {
                    const data = await response.json();
                    if (data.posts && data.posts.length > 0) {
                        posts = data.posts;
                        renderPosts();
                        return;
                    }
                }
            } catch (error) {
                console.log('Database load failed, trying localStorage:', error);
            }
            
            // Fallback to localStorage - load all users' posts
            posts = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.startsWith('connectPosts_')) {
                    const userPosts = JSON.parse(localStorage.getItem(key));
                    if (userPosts && Array.isArray(userPosts)) {
                        posts = posts.concat(userPosts);
                    }
                }
            }
            
            // Sort by timestamp (newest first)
            posts.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            renderPosts();
        }
        
        // Load all posts for home feed (GLOBAL - from all users)
        async function loadAllPostsForHome() {
            console.log('🏠 Loading all posts for home feed (GLOBAL)...');
            try {
                // Try to load all posts from database
                const response = await fetch('/api/posts');
                console.log('🏠 Database response status:', response.status);
                console.log('🏠 Database response ok:', response.ok);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('🏠 Database response data:', data);
                    
                    if (data.posts && data.posts.length > 0) {
                        posts = data.posts;
                        console.log('🏠 Loaded', posts.length, 'posts from database (GLOBAL)');
                        console.log('🏠 First post:', posts[0]);
                        renderPosts();
                        return;
                    } else {
                        console.log('🏠 No posts in database response');
                    }
                } else {
                    console.log('🏠 Database response not ok:', response.status);
                }
            } catch (error) {
                console.log('🏠 Database load failed, trying localStorage:', error);
            }
            
            // Fallback: load from GLOBAL localStorage
            const savedPosts = localStorage.getItem('connectPosts');
            if (savedPosts) {
                posts = JSON.parse(savedPosts);
                console.log('🏠 Loaded', posts.length, 'posts from localStorage (GLOBAL)');
            } else {
                posts = [];
                console.log('🏠 No posts found in localStorage');
            }
            
            renderPosts();
        }
        
        // Load user-specific posts (for profile section)
        async function loadUserPosts() {
            if (currentUser && currentUser.id) {
                // Try to load from database first
                try {
                    const response = await fetch(`/api/posts/${currentUser.id}`);
                    if (response.ok) {
                        const data = await response.json();
                        if (data.posts && data.posts.length > 0) {
                            posts = data.posts;
                            renderPosts();
                            return;
                        }
                    }
                } catch (error) {
                    console.log('Database load failed, trying localStorage:', error);
                }
                
                // Fallback to localStorage
                const userPostsKey = `connectPosts_${currentUser.id}`;
                const savedUserPosts = localStorage.getItem(userPostsKey);
                if (savedUserPosts) {
                    posts = JSON.parse(savedUserPosts);
                } else {
                    // Initialize with empty posts for new user
                    posts = [];
                }
                renderPosts();
            } else {
                // Fallback to global posts if no user ID
                loadPosts();
            }
        }
        
        // Load all posts from database (for explore section)
        async function loadAllPostsFromDatabase() {
            try {
                const response = await fetch('/api/posts');
                if (response.ok) {
                    const data = await response.json();
                    if (data.posts && data.posts.length > 0) {
                        posts = data.posts;
                        renderPosts();
                        return;
                    }
                }
            } catch (error) {
                console.log('Database load failed, trying localStorage:', error);
            }
            
            // Fallback to localStorage - load all users' posts
            posts = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.startsWith('connectPosts_')) {
                    const userPosts = JSON.parse(localStorage.getItem(key));
                    if (userPosts && Array.isArray(userPosts)) {
                        posts = posts.concat(userPosts);
                    }
                }
            }
            
            // Sort by timestamp (newest first)
            posts.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            renderPosts();
        }

        // Save posts to localStorage and database
        async function savePosts() {
            // Save to GLOBAL localStorage (not user-specific)
            localStorage.setItem('connectPosts', JSON.stringify(posts));
            
            // Save to database via API (GLOBAL)
            try {
                const response = await fetch('/api/posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        posts: posts
                    })
                });
                
                if (!response.ok) {
                    console.log('Database save failed, using localStorage only');
                }
            } catch (error) {
                console.log('Database save error, using localStorage only:', error);
            }
        }

        // Create new post
        async function createPost() {
            const postText = document.getElementById('postText').value;
            const hasMedia = window.pendingMedia !== null && window.pendingMedia !== undefined;
            
            if (postText.trim() || hasMedia) {
                const newPost = {
                    id: Date.now(),
                    user: {
                        ...currentUser,
                        avatar: currentUser.avatar || 'fas fa-user',
                        avatarType: currentUser.avatarType || 'icon'
                    },
                    content: postText,
                    media: window.pendingMedia || null,
                    likes: 0,
                    comments: [],
                    retweets: 0,
                    timestamp: new Date(),
                    liked: false,
                    retweeted: false
                };
                
                posts.unshift(newPost);
                await savePosts();
                renderPosts();
                document.getElementById('postText').value = '';
                window.pendingMedia = null;
                
                // Add notification for new post - GLOBAL NOTIFICATION
                console.log('🔔 Adding new post notification:', {
                    postId: newPost.id,
                    postContent: postText.substring(0, 100) + '...',
                    hasMedia: hasMedia
                });
                addNotification('📝 Nuovo Post', 
                    `${currentUser.name} ha pubblicato un nuovo post`, 
                    null, // NULL = GLOBAL NOTIFICATION FOR ALL USERS
                    {
                        postId: newPost.id,
                        postContent: postText.substring(0, 100) + '...',
                        hasMedia: hasMedia,
                        mediaType: hasMedia ? window.pendingMedia?.type : null,
                        global: true // Mark as global notification
                    }
                );
                
                // Show notification
                if (hasMedia) {
                    showNotification('Post con media pubblicato con successo!', 'success');
                } else {
                    showNotification('Post pubblicato con successo!', 'success');
                }
                
                console.log('Post creato:', newPost);
            } else {
                showNotification('Scrivi qualcosa o aggiungi un media!');
            }
        }

        // Add photo to post
        function addPhoto() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.multiple = true;
            input.onchange = function(e) {
                const files = Array.from(e.target.files);
                if (files.length > 0) {
                    // Process first file
                    const file = files[0];
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        window.pendingMedia = {
                            type: 'photo',
                            data: e.target.result,
                            name: file.name,
                            size: file.size
                        };
                        showNotification(`Foto selezionata: ${file.name}`);
                        console.log('Foto caricata:', file.name, file.size);
                    };
                    reader.onerror = function() {
                        showNotification('Errore nel caricamento della foto!');
                        console.error('Errore nel caricamento della foto');
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        // Add video to post
        function addVideo() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'video/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    // Check file size (max 50MB)
                    if (file.size > 50 * 1024 * 1024) {
                        showNotification('Video troppo grande! Massimo 50MB');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        window.pendingMedia = {
                            type: 'video',
                            data: e.target.result,
                            name: file.name,
                            size: file.size
                        };
                        showNotification(`Video selezionato: ${file.name}`);
                        console.log('Video caricato:', file.name, file.size);
                    };
                    reader.onerror = function() {
                        showNotification('Errore nel caricamento del video!');
                        console.error('Errore nel caricamento del video');
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        // Add GIF
        function addGif() {
            const gifModal = document.createElement('div');
            gifModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            gifModal.innerHTML = `
                <div style="background: #1a1a1a; padding: 30px; border-radius: 15px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <h3 style="margin-bottom: 20px; color: #fff;">🎭 Seleziona GIF</h3>
                    
                    <!-- Search Bar -->
                    <div style="margin-bottom: 20px;">
                        <input type="text" id="gifSearch" placeholder="🔍 Cerca GIF (es: WhatsApp, emoji, reazioni...)" 
                               onkeypress="if(event.key==='Enter') searchGifFromInput()" 
                               style="width: 100%; padding: 15px; border: 2px solid #333; border-radius: 10px; background: #333; color: #fff; font-size: 16px; outline: none;">
                        <button onclick="searchGifFromInput()" style="margin-top: 10px; background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; width: 100%;">🔍 Cerca GIF</button>
                    </div>
                    
                    <!-- Categories -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #fff; margin-bottom: 10px;">📱 Categorie Popolari</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                            <button onclick="searchGif('WhatsApp')" style="background: #25D366; color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 14px;">📱 WhatsApp</button>
                            <button onclick="searchGif('emoji')" style="background: #FF6B6B; color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 14px;">😀 Emoji</button>
                            <button onclick="searchGif('reazioni')" style="background: #4ECDC4; color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 14px;">🎭 Reazioni</button>
                            <button onclick="searchGif('divertimento')" style="background: #FFE66D; color: #333; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 14px;">😂 Divertimento</button>
                            <button onclick="searchGif('amore')" style="background: #FF69B4; color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 14px;">💕 Amore</button>
                            <button onclick="searchGif('sport')" style="background: #87CEEB; color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 14px;">⚽ Sport</button>
                        </div>
                    </div>
                    
                    <!-- GIF Grid -->
                    <div id="gifGrid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
                        <!-- WhatsApp GIFs -->
                        <button onclick="selectGif('https://media.giphy.com/media/3o7btPCcdNniyf0ArS/giphy.gif')" style="background: #333; border: none; padding: 10px; border-radius: 10px; cursor: pointer;">
                            <img src="https://media.giphy.com/media/3o7btPCcdNniyf0ArS/giphy.gif" style="width: 100%; height: 100px; object-fit: cover; border-radius: 5px;">
                        </button>
                        <button onclick="selectGif('https://media.giphy.com/media/26BRrSvJUaNzURxXG/giphy.gif')" style="background: #333; border: none; padding: 10px; border-radius: 10px; cursor: pointer;">
                            <img src="https://media.giphy.com/media/26BRrSvJUaNzURxXG/giphy.gif" style="width: 100%; height: 100px; object-fit: cover; border-radius: 5px;">
                        </button>
                        <button onclick="selectGif('https://media.giphy.com/media/3o7aCRloybJlXJbCje/giphy.gif')" style="background: #333; border: none; padding: 10px; border-radius: 10px; cursor: pointer;">
                            <img src="https://media.giphy.com/media/3o7aCRloybJlXJbCje/giphy.gif" style="width: 100%; height: 100px; object-fit: cover; border-radius: 5px;">
                        </button>
                        <button onclick="selectGif('https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif')" style="background: #333; border: none; padding: 10px; border-radius: 10px; cursor: pointer;">
                            <img src="https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif" style="width: 100%; height: 100px; object-fit: cover; border-radius: 5px;">
                        </button>
                        <button onclick="selectGif('https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif')" style="background: #333; border: none; padding: 10px; border-radius: 10px; cursor: pointer;">
                            <img src="https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif" style="width: 100%; height: 100px; object-fit: cover; border-radius: 5px;">
                        </button>
                        <button onclick="selectGif('https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif')" style="background: #333; border: none; padding: 10px; border-radius: 10px; cursor: pointer;">
                            <img src="https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif" style="width: 100%; height: 100px; object-fit: cover; border-radius: 5px;">
                        </button>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="gifSearch" placeholder="Cerca GIF..." style="flex: 1; background: #333; border: 1px solid #555; border-radius: 10px; padding: 10px; color: #fff; outline: none;">
                        <button onclick="searchGif()" style="background: #1d9bf0; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <button onclick="this.closest('div').parentElement.remove()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; margin-top: 20px; width: 100%;">
                        Chiudi
                    </button>
                </div>
            `;
            
            document.body.appendChild(gifModal);
        }
        
        // Select GIF
        function selectGif(gifUrl) {
            window.pendingMedia = {
                type: 'gif',
                data: gifUrl,
                name: 'GIF'
            };
            showNotification('GIF selezionata!');
            document.querySelector('[style*="position: fixed"]').remove();
        }

        // Search GIF function
        function searchGif(query) {
            const gifGrid = document.getElementById('gifGrid');
            if (!gifGrid) return;
            
            // Clear existing GIFs
            gifGrid.innerHTML = '';
            
            // Popular GIFs based on query
            const gifCategories = {
                'WhatsApp': [
                    'https://media.giphy.com/media/3o7btPCcdNniyf0ArS/giphy.gif',
                    'https://media.giphy.com/media/26BRrSvJUaNzURxXG/giphy.gif',
                    'https://media.giphy.com/media/3o7aCRloybJlXJbCje/giphy.gif',
                    'https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif',
                    'https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif',
                    'https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif'
                ],
                'emoji': [
                    'https://media.giphy.com/media/3o7btPCcdNniyf0ArS/giphy.gif',
                    'https://media.giphy.com/media/26BRrSvJUaNzURxXG/giphy.gif',
                    'https://media.giphy.com/media/3o7aCRloybJlXJbCje/giphy.gif',
                    'https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif',
                    'https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif',
                    'https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif'
                ],
                'reazioni': [
                    'https://media.giphy.com/media/3o7btPCcdNniyf0ArS/giphy.gif',
                    'https://media.giphy.com/media/26BRrSvJUaNzURxXG/giphy.gif',
                    'https://media.giphy.com/media/3o7aCRloybJlXJbCje/giphy.gif',
                    'https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif',
                    'https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif',
                    'https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif'
                ],
                'divertimento': [
                    'https://media.giphy.com/media/3o7btPCcdNniyf0ArS/giphy.gif',
                    'https://media.giphy.com/media/26BRrSvJUaNzURxXG/giphy.gif',
                    'https://media.giphy.com/media/3o7aCRloybJlXJbCje/giphy.gif',
                    'https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif',
                    'https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif',
                    'https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif'
                ],
                'amore': [
                    'https://media.giphy.com/media/3o7btPCcdNniyf0ArS/giphy.gif',
                    'https://media.giphy.com/media/26BRrSvJUaNzURxXG/giphy.gif',
                    'https://media.giphy.com/media/3o7aCRloybJlXJbCje/giphy.gif',
                    'https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif',
                    'https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif',
                    'https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif'
                ],
                'sport': [
                    'https://media.giphy.com/media/3o7btPCcdNniyf0ArS/giphy.gif',
                    'https://media.giphy.com/media/26BRrSvJUaNzURxXG/giphy.gif',
                    'https://media.giphy.com/media/3o7aCRloybJlXJbCje/giphy.gif',
                    'https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif',
                    'https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif',
                    'https://media.giphy.com/media/3o7aTskTEUldURA1uM/giphy.gif'
                ]
            };
            
            // Check if query matches a category
            let gifs = gifCategories[query];
            
            // If no exact match, try to find similar categories
            if (!gifs) {
                const lowerQuery = query.toLowerCase();
                if (lowerQuery.includes('whatsapp') || lowerQuery.includes('wa')) {
                    gifs = gifCategories['WhatsApp'];
                } else if (lowerQuery.includes('emoji') || lowerQuery.includes('smile')) {
                    gifs = gifCategories['emoji'];
                } else if (lowerQuery.includes('reazione') || lowerQuery.includes('reaction')) {
                    gifs = gifCategories['reazioni'];
                } else if (lowerQuery.includes('divertimento') || lowerQuery.includes('fun') || lowerQuery.includes('laugh')) {
                    gifs = gifCategories['divertimento'];
                } else if (lowerQuery.includes('amore') || lowerQuery.includes('love') || lowerQuery.includes('heart')) {
                    gifs = gifCategories['amore'];
                } else if (lowerQuery.includes('sport') || lowerQuery.includes('football') || lowerQuery.includes('soccer')) {
                    gifs = gifCategories['sport'];
                } else {
                    // Default to WhatsApp GIFs
                    gifs = gifCategories['WhatsApp'];
                }
            }
            
            gifs.forEach(gifUrl => {
                const button = document.createElement('button');
                button.style.cssText = 'background: #333; border: none; padding: 10px; border-radius: 10px; cursor: pointer;';
                button.onclick = () => selectGif(gifUrl);
                
                const img = document.createElement('img');
                img.src = gifUrl;
                img.style.cssText = 'width: 100%; height: 100px; object-fit: cover; border-radius: 5px;';
                
                button.appendChild(img);
                gifGrid.appendChild(button);
            });
            
            showNotification(`🔍 Ricerca: ${query}`, 'info');
        }
        
        // Search GIF from input
        function searchGifFromInput() {
            const searchTerm = document.getElementById('gifSearch').value;
            if (searchTerm.trim()) {
                searchGif(searchTerm);
            }
        }
        
        // Search functions
        function handleSearchKeypress(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        }
        
        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (searchTerm) {
                showSection('search');
                searchPosts(searchTerm);
                searchUsers(searchTerm);
                searchHashtags(searchTerm);
            }
        }
        
        function searchPosts(searchTerm) {
            const searchPostsContainer = document.getElementById('searchPosts');
            const filteredPosts = posts.filter(post => 
                post.content.toLowerCase().includes(searchTerm.toLowerCase()) ||
                post.user.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                post.user.username.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            if (filteredPosts.length === 0) {
                searchPostsContainer.innerHTML = '<p style="color: #71767b; text-align: center; padding: 20px;">Nessun post trovato per "' + searchTerm + '"</p>';
            } else {
                searchPostsContainer.innerHTML = filteredPosts.map(post => createPostElement(post).outerHTML).join('');
            }
        }
        
        function searchUsers(searchTerm) {
            const searchUsersContainer = document.getElementById('searchUsers');
            // Mock users for demo
            const mockUsers = [
                { name: 'Mario Rossi', username: '@mariorossi', avatar: 'fas fa-user' },
                { name: 'Giulia Bianchi', username: '@giuliabianchi', avatar: 'fas fa-user' },
                { name: 'Luca Verdi', username: '@lucaverdi', avatar: 'fas fa-user' },
                { name: 'Anna Neri', username: '@annaneri', avatar: 'fas fa-user' }
            ];
            
            const filteredUsers = mockUsers.filter(user => 
                user.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                user.username.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            if (filteredUsers.length === 0) {
                searchUsersContainer.innerHTML = '<p style="color: #71767b; text-align: center; padding: 20px;">Nessun utente trovato per "' + searchTerm + '"</p>';
            } else {
                searchUsersContainer.innerHTML = filteredUsers.map(user => `
                    <div class="user-search-item">
                        <div class="user-search-avatar">
                            <i class="${user.avatar}"></i>
                        </div>
                        <div class="user-search-info">
                            <div class="user-search-name">${user.name}</div>
                            <div class="user-search-username">${user.username}</div>
                        </div>
                        <button style="background: #1d9bf0; color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer;">
                            Segui
                        </button>
                    </div>
                `).join('');
            }
        }
        
        function searchHashtags(searchTerm) {
            const searchHashtagsContainer = document.getElementById('searchHashtags');
            // Mock hashtags for demo
            const mockHashtags = [
                { name: '#Connect', count: '1.2K post' },
                { name: '#Social', count: '856 post' },
                { name: '#Tech', count: '2.1K post' },
                { name: '#Innovation', count: '543 post' }
            ];
            
            const filteredHashtags = mockHashtags.filter(hashtag => 
                hashtag.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            if (filteredHashtags.length === 0) {
                searchHashtagsContainer.innerHTML = '<p style="color: #71767b; text-align: center; padding: 20px;">Nessun hashtag trovato per "' + searchTerm + '"</p>';
            } else {
                searchHashtagsContainer.innerHTML = filteredHashtags.map(hashtag => `
                    <div class="hashtag-item">
                        <div class="hashtag-icon">
                            <i class="fas fa-hashtag"></i>
                        </div>
                        <div class="hashtag-info">
                            <div class="hashtag-name">${hashtag.name}</div>
                            <div class="hashtag-count">${hashtag.count}</div>
                        </div>
                    </div>
                `).join('');
            }
        }
        
        function showSearchTab(tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('.search-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.search-tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            document.getElementById('search-' + tabName).classList.add('active');
        }

        // Add Poll
        function addPoll() {
            const pollModal = document.createElement('div');
            pollModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            pollModal.innerHTML = `
                <div style="background: #1a1a1a; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
                    <h3 style="margin-bottom: 20px; color: #fff;">Crea Sondaggio</h3>
                    <div style="margin-bottom: 20px;">
                        <label style="color: #fff; display: block; margin-bottom: 10px;">Domanda del sondaggio:</label>
                        <input type="text" id="pollQuestion" placeholder="Qual è la tua preferenza?" style="width: 100%; background: #333; border: 1px solid #555; border-radius: 10px; padding: 10px; color: #fff; outline: none;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="color: #fff; display: block; margin-bottom: 10px;">Opzioni (2-4):</label>
                        <input type="text" id="pollOption1" placeholder="Opzione 1" style="width: 100%; background: #333; border: 1px solid #555; border-radius: 10px; padding: 10px; color: #fff; outline: none; margin-bottom: 10px;">
                        <input type="text" id="pollOption2" placeholder="Opzione 2" style="width: 100%; background: #333; border: 1px solid #555; border-radius: 10px; padding: 10px; color: #fff; outline: none; margin-bottom: 10px;">
                        <input type="text" id="pollOption3" placeholder="Opzione 3 (opzionale)" style="width: 100%; background: #333; border: 1px solid #555; border-radius: 10px; padding: 10px; color: #fff; outline: none; margin-bottom: 10px;">
                        <input type="text" id="pollOption4" placeholder="Opzione 4 (opzionale)" style="width: 100%; background: #333; border: 1px solid #555; border-radius: 10px; padding: 10px; color: #fff; outline: none; margin-bottom: 10px;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="color: #fff; display: block; margin-bottom: 10px;">Durata del sondaggio:</label>
                        <select id="pollDuration" style="width: 100%; background: #333; border: 1px solid #555; border-radius: 10px; padding: 10px; color: #fff; outline: none;">
                            <option value="1">1 giorno</option>
                            <option value="3">3 giorni</option>
                            <option value="7">1 settimana</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="createPoll()" style="background: #1d9bf0; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; flex: 1;">
                            Crea Sondaggio
                        </button>
                        <button onclick="this.closest('div').parentElement.remove()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                            Annulla
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(pollModal);
        }
        
        // Create Poll
        function createPoll() {
            const question = document.getElementById('pollQuestion').value;
            const option1 = document.getElementById('pollOption1').value;
            const option2 = document.getElementById('pollOption2').value;
            const option3 = document.getElementById('pollOption3').value;
            const option4 = document.getElementById('pollOption4').value;
            const duration = document.getElementById('pollDuration').value;
            
            if (question.trim() && option1.trim() && option2.trim()) {
                const options = [option1, option2];
                if (option3.trim()) options.push(option3);
                if (option4.trim()) options.push(option4);
                
                window.pendingMedia = {
                    type: 'poll',
                    data: {
                        question: question,
                        options: options,
                        duration: duration,
                        votes: {},
                        totalVotes: 0
                    },
                    name: 'Sondaggio'
                };
                
                showNotification('Sondaggio creato!');
                document.querySelector('[style*="position: fixed"]').remove();
            } else {
                showNotification('Compila almeno domanda e 2 opzioni!');
            }
        }

        // Render posts
        function renderPosts() {
            console.log('📝 Rendering posts:', posts.length);
            const postsContainer = document.getElementById('posts');
            if (postsContainer) {
                postsContainer.innerHTML = '';
                posts.forEach(post => {
                    console.log('📝 Rendering post:', post.id, 'with', post.comments.length, 'comments');
                    const postElement = createPostElement(post);
                    postsContainer.appendChild(postElement);
                });
            } else {
                console.log('📝 Posts container not found');
            }
        }

        // Create post element
        function createPostElement(post) {
            const postDiv = document.createElement('div');
            postDiv.className = 'post';
            postDiv.innerHTML = `
                <div class="post-header">
                    <div class="post-avatar" style="background-image: ${post.user.avatarType === 'image' ? `url(${post.user.avatar})` : 'none'}; background-size: cover; background-position: center;">
                        ${post.user.avatarType === 'image' ? '' : `<i class="${post.user.avatar}"></i>`}
                    </div>
                    <div class="post-info">
                        <div class="post-name">${post.user.name}</div>
                        <div class="post-username">${post.user.username}</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="post-time">${formatTime(post.timestamp)}</div>
                        ${currentUser && currentUser.id === post.user.id ? 
                            `<button onclick="deletePost(${post.id})" class="delete-btn" title="Elimina post">
                                <i class="fas fa-trash"></i>
                            </button>` : ''
                        }
                    </div>
                </div>
                <div class="post-content">${post.content}</div>
                ${post.media ? `
                    <div class="post-media">
                        ${post.media.type === 'photo' ? 
                            `<img src="${post.media.data}" alt="${post.media.name}">` :
                            post.media.type === 'video' ?
                            `<video controls><source src="${post.media.data}" type="video/mp4"></video>` :
                            post.media.type === 'gif' ?
                            `<img src="${post.media.data}" alt="GIF" style="max-height: 300px;">` :
                            post.media.type === 'poll' ?
                            `<div style="background: #1a1a1a; padding: 20px; border-radius: 10px; margin: 10px 0;">
                                <h4 style="color: #fff; margin-bottom: 15px;">📊 ${post.media.data.question}</h4>
                                <div style="display: flex; flex-direction: column; gap: 10px;">
                                    ${post.media.data.options.map((option, index) => `
                                        <button onclick="votePoll(${post.id}, ${index})" style="background: #333; border: 1px solid #555; border-radius: 10px; padding: 10px; color: #fff; cursor: pointer; text-align: left;">
                                            ${option}
                                        </button>
                                    `).join('')}
                                </div>
                                <div style="color: #71767b; font-size: 0.9rem; margin-top: 10px;">
                                    ${post.media.data.totalVotes} voti
                                </div>
                            </div>` : ''
                        }
                    </div>
                ` : ''}
                <div class="post-actions">
                    <button class="action-btn" onclick="toggleComments(${post.id})">
                        <i class="fas fa-comment"></i>
                        <span>${post.comments.length}</span>
                    </button>
                    <button class="action-btn ${post.retweeted ? 'liked' : ''}" onclick="toggleRetweet(${post.id})">
                        <i class="fas fa-retweet"></i>
                        <span>${post.retweets}</span>
                    </button>
                    <button class="action-btn ${post.liked ? 'liked' : ''}" onclick="toggleLike(${post.id})">
                        <i class="fas fa-heart"></i>
                        <span>${post.likes}</span>
                    </button>
                    <button class="action-btn" onclick="sharePost(${post.id})">
                        <i class="fas fa-share"></i>
                    </button>
                </div>
                <div class="comments" id="comments-${post.id}" style="display: none;">
                    ${post.comments.map((comment, commentIndex) => `
                        <div class="comment">
                            <div class="comment-avatar">
                                <i class="${comment.user.avatar}"></i>
                            </div>
                            <div class="comment-content">
                                <div class="comment-header">
                                    <span class="comment-name">${comment.user.name}</span>
                                    <span class="comment-time">${formatTime(comment.timestamp)}</span>
                                    ${currentUser && currentUser.id === comment.user.id ? 
                                        `<button onclick="deleteComment(${post.id}, ${commentIndex})" class="delete-btn" style="margin-left: 10px;" title="Elimina commento">
                                            <i class="fas fa-trash" style="font-size: 0.8rem;"></i>
                                        </button>` : ''
                                    }
                                </div>
                                <div class="comment-text">${comment.content}</div>
                            </div>
                        </div>
                    `).join('')}
                    <div class="comment-input">
                        <input type="text" placeholder="Scrivi un commento..." onkeypress="handleCommentKeypress(event, ${post.id})">
                        <button class="comment-submit" onclick="addComment(${post.id})">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            `;
            return postDiv;
        }

        // Toggle like
        function toggleLike(postId) {
            const post = posts.find(p => p.id === postId);
            if (post) {
                post.liked = !post.liked;
                post.likes += post.liked ? 1 : -1;
                
                // Add notification for post owner (if different from liker)
                if (post.liked && post.user.id !== currentUser.id) {
                    console.log('🔔 Adding like notification:', {
                        postOwner: post.user.id,
                        currentUser: currentUser.id,
                        liked: post.liked
                    });
                    addNotification('❤️ Nuovo Like', 
                        `${currentUser.name} ha messo like al tuo post`, 
                        post.user.id, 
                        {
                            liker: currentUser.name,
                            postId: postId,
                            postContent: post.content.substring(0, 100) + '...'
                        }
                    );
                } else {
                    console.log('🔔 No like notification needed:', {
                        liked: post.liked,
                        sameUser: post.user.id === currentUser.id
                    });
                }
                
                savePosts();
                renderPosts();
            }
        }

        // Toggle retweet
        function toggleRetweet(postId) {
            const post = posts.find(p => p.id === postId);
            if (post) {
                post.retweeted = !post.retweeted;
                post.retweets += post.retweeted ? 1 : -1;
                
                // Add notification for post owner (if different from retweeter)
                if (post.retweeted && post.user.id !== currentUser.id) {
                    addNotification('🔄 Nuovo Retweet', 
                        `${currentUser.name} ha condiviso il tuo post`, 
                        post.user.id, 
                        {
                            retweeter: currentUser.name,
                            postId: postId,
                            postContent: post.content.substring(0, 100) + '...'
                        }
                    );
                }
                
                savePosts();
                renderPosts();
            }
        }

        // Toggle comments
        function toggleComments(postId) {
            console.log('💬 Toggle comments for post:', postId);
            const commentsDiv = document.getElementById(`comments-${postId}`);
            if (commentsDiv) {
                const isHidden = commentsDiv.style.display === 'none';
                commentsDiv.style.display = isHidden ? 'block' : 'none';
                console.log('💬 Comments visibility:', isHidden ? 'shown' : 'hidden');
            } else {
                console.log('💬 Comments div not found for post:', postId);
            }
        }

        // Add comment
        async function addComment(postId) {
            console.log('💬 Adding comment to post:', postId);
            const input = document.querySelector(`#comments-${postId} input`);
            console.log('💬 Input element found:', !!input);
            const content = input.value.trim();
            console.log('💬 Comment content:', content);
            if (content) {
                const post = posts.find(p => p.id === postId);
                if (post) {
                    post.comments.push({
                        user: currentUser,
                        content: content,
                        timestamp: new Date()
                    });
                    
                    // Add notification for post owner (if different from commenter)
                    if (post.user.id !== currentUser.id) {
                        console.log('🔔 Adding comment notification:', {
                            postOwner: post.user.id,
                            currentUser: currentUser.id,
                            comment: content
                        });
                        addNotification('💬 Nuovo Commento', 
                            `${currentUser.name} ha commentato il tuo post`, 
                            post.user.id, 
                            {
                                commenter: currentUser.name,
                                comment: content,
                                postId: postId,
                                postContent: post.content.substring(0, 100) + '...'
                            }
                        );
                    } else {
                        console.log('🔔 No notification needed - same user');
                    }
                    
                    await savePosts();
                    renderPosts();
                    input.value = '';
                }
            }
        }

        // Handle comment keypress
        function handleCommentKeypress(event, postId) {
            if (event.key === 'Enter') {
                addComment(postId);
            }
        }

        // Share post to all social networks
        function sharePost(postId) {
            const post = posts.find(p => p.id === postId);
            if (post) {
                const shareText = `Guarda questo post da Connect: ${post.content}`;
                const shareUrl = window.location.href;
                
                // Create share modal
                const shareModal = document.createElement('div');
                shareModal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                `;
                
                shareModal.innerHTML = `
                    <div style="background: #1a1a1a; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
                        <h3 style="margin-bottom: 20px; color: #fff;">Condividi su</h3>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                            <button onclick="shareToTwitter('${shareText}', '${shareUrl}')" style="background: #1da1f2; color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer;">
                                <i class="fab fa-twitter"></i> Twitter
                            </button>
                            <button onclick="shareToFacebook('${shareText}', '${shareUrl}')" style="background: #1877f2; color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer;">
                                <i class="fab fa-facebook"></i> Facebook
                            </button>
                            <button onclick="shareToLinkedIn('${shareText}', '${shareUrl}')" style="background: #0077b5; color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer;">
                                <i class="fab fa-linkedin"></i> LinkedIn
                            </button>
                            <button onclick="shareToWhatsApp('${shareText}', '${shareUrl}')" style="background: #25d366; color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer;">
                                <i class="fab fa-whatsapp"></i> WhatsApp
                            </button>
                            <button onclick="shareToTelegram('${shareText}', '${shareUrl}')" style="background: #0088cc; color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer;">
                                <i class="fab fa-telegram"></i> Telegram
                            </button>
                            <button onclick="copyToClipboard('${shareText}')" style="background: #6c757d; color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer;">
                                <i class="fas fa-copy"></i> Copia
                            </button>
                        </div>
                        <button onclick="this.closest('div').parentElement.remove()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; margin-top: 20px; width: 100%;">
                            Chiudi
                        </button>
                    </div>
                `;
                
                document.body.appendChild(shareModal);
            }
        }

        // Share to Twitter
        function shareToTwitter(text, url) {
            const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
            window.open(twitterUrl, '_blank');
            showNotification('Condiviso su Twitter!');
        }

        // Share to Facebook
        function shareToFacebook(text, url) {
            const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}&quote=${encodeURIComponent(text)}`;
            window.open(facebookUrl, '_blank');
            showNotification('Condiviso su Facebook!');
        }

        // Share to LinkedIn
        function shareToLinkedIn(text, url) {
            const linkedinUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}&summary=${encodeURIComponent(text)}`;
            window.open(linkedinUrl, '_blank');
            showNotification('Condiviso su LinkedIn!');
        }

        // Share to WhatsApp
        function shareToWhatsApp(text, url) {
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text + ' ' + url)}`;
            window.open(whatsappUrl, '_blank');
            showNotification('Condiviso su WhatsApp!');
        }

        // Share to Telegram
        function shareToTelegram(text, url) {
            const telegramUrl = `https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`;
            window.open(telegramUrl, '_blank');
            showNotification('Condiviso su Telegram!');
        }

        // Copy to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Copiato negli appunti!');
            });
        }

        // Change profile picture
        function changeProfilePic() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const profilePic = document.querySelector('.composer-avatar');
                        profilePic.innerHTML = `<img src="${e.target.result}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                        showNotification('Foto profilo aggiornata!');
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#007bff'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 1000;
                max-width: 300px;
                word-wrap: break-word;
                animation: slideIn 0.3s ease-out;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }
        
        // Add notification styles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        
        // Notification system
        let notifications = JSON.parse(localStorage.getItem('connectNotifications') || '[]');
        
        // Save notifications
        function saveNotifications() {
            localStorage.setItem('connectNotifications', JSON.stringify(notifications));
        }
        
        // Add notification
        function addNotification(type, message, userId = null, details = null) {
            console.log('🔔 addNotification called:', { type, message, userId, details });
            const notification = {
                id: Date.now(),
                type: type,
                message: message,
                userId: userId,
                details: details, // Aggiungiamo dettagli extra
                timestamp: new Date(),
                read: false
            };
            notifications.unshift(notification);
            saveNotifications();
            updateNotificationBadge();
            console.log('🔔 Notification added:', notification);
        }
        
        // Make function global
        window.addNotification = addNotification;
        
        // Test notification function
        function testNotification() {
            console.log('🔔 Testing notification system');
            addNotification('🧪 Test Notifica', 'Questa è una notifica di test', null, {
                test: true,
                timestamp: new Date().toISOString()
            });
            showNotification('Notifica di test aggiunta!', 'success');
        }
        
        // Make test function global
        window.testNotification = testNotification;
        
        // Load real users function
        async function loadRealUsers() {
            console.log('👥 Loading real users...');
            const realUsersList = document.getElementById('realUsersList');
            const noUsersMessage = document.querySelector('.no-users-message');
            
            // Also load mobile users
            loadMobileUsers();
            
            if (realUsersList) {
                try {
                    // Demo users for testing
                    const demoUsers = [
                        { id: 1, username: 'marcorossi', name: 'Marco Rossi', email: 'marco@example.com', avatar: 'fas fa-user', avatarType: 'icon', status: 'online' },
                        { id: 2, username: 'sofiatech', name: 'Sofia Tech', email: 'sofia@example.com', avatar: 'fas fa-user', avatarType: 'icon', status: 'online' },
                        { id: 3, username: 'technewsit', name: 'Tech News Italia', email: 'tech@example.com', avatar: 'fas fa-user', avatarType: 'icon', status: 'online' },
                        { id: 4, username: 'testuser', name: 'Test User', email: 'test@example.com', avatar: 'fas fa-user', avatarType: 'icon', status: 'online' },
                        { id: 5, username: 'fabbietto75', name: 'Fabbietto', email: 'fabio@example.com', avatar: 'fas fa-user', avatarType: 'icon', status: 'online' }
                    ];
                    
                    console.log('👥 Demo users loaded:', demoUsers);
                    console.log('👥 Current user ID:', currentUser.id);
                    console.log('👥 Current user email:', currentUser.email);
                    // Filter out current user by ID and email
                    const realUsers = demoUsers.filter(user => {
                        const isNotCurrentUser = user.id !== currentUser.id;
                        const isNotCurrentEmail = user.email !== currentUser.email;
                        console.log(`👥 User ${user.username}: ID match=${user.id === currentUser.id}, Email match=${user.email === currentUser.email}`);
                        return isNotCurrentUser && isNotCurrentEmail;
                    });
                    console.log('👥 Real users (filtered):', realUsers);
                    
                    if (realUsers.length > 0) {
                        noUsersMessage.style.display = 'none';
                        realUsersList.innerHTML = realUsers.map(user => `
                            <div class="follow-user">
                                <div class="follow-avatar">
                                    ${user.avatar && user.avatarType === 'image' ? 
                                        `<img src="${user.avatar}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">` :
                                        `<i class="${user.avatar || 'fas fa-user'}"></i>`
                                    }
                                </div>
                                <div class="follow-info">
                                    <div class="follow-name">${user.name || user.username || 'Utente'}</div>
                                    <div class="follow-username">@${user.username || 'user'}</div>
                                </div>
                                <button class="follow-btn" onclick="followUser('${user.id}')">Segui</button>
                                <button class="message-btn" onclick="openChat('${user.id}')" style="background: #1a8cd8; color: white; border: none; padding: 8px 12px; border-radius: 20px; cursor: pointer; margin-left: 5px; font-size: 12px;">💬</button>
                            </div>
                        `).join('');
                    } else {
                        noUsersMessage.style.display = 'block';
                        realUsersList.innerHTML = '';
                    }
                } catch (error) {
                    console.log('👥 Error loading real users:', error);
                    noUsersMessage.style.display = 'block';
                    realUsersList.innerHTML = '';
                }
            }
        }
        
        // Follow user function
        function followUser(userId) {
            console.log('👥 Following user:', userId);
            showNotification('Funzione follow in sviluppo!', 'info');
        }
        
        // Load mobile users function
        async function loadMobileUsers() {
            console.log('📱 Loading mobile users...');
            const mobileUsersList = document.getElementById('mobileUsersList');
            const mobileNoUsersMessage = document.querySelector('.mobile-no-users-message');
            
            if (mobileUsersList) {
                try {
                    // Try to load users from backend
                    const response = await fetch('/api/users');
                    if (response.ok) {
                        const data = await response.json();
                        console.log('📱 Mobile users from backend:', data);
                        console.log('📱 Current user ID:', currentUser.id);
                        console.log('📱 Current user email:', currentUser.email);
                        
                        // Check if data is an array, if not use demo users
                        const users = Array.isArray(data) ? data : [];
                        console.log('📱 Users array:', users);
                        
                        // Filter out current user by ID and email
                        const realUsers = users.filter(user => {
                            const isNotCurrentUser = user.id !== currentUser.id;
                            const isNotCurrentEmail = user.email !== currentUser.email;
                            console.log(`📱 Mobile User ${user.username}: ID match=${user.id === currentUser.id}, Email match=${user.email === currentUser.email}`);
                            return isNotCurrentUser && isNotCurrentEmail;
                        });
                        console.log('📱 Mobile real users (filtered):', realUsers);
                        
                        if (realUsers.length > 0) {
                            mobileNoUsersMessage.style.display = 'none';
                            mobileUsersList.innerHTML = realUsers.map(user => `
                                <div class="mobile-user-item">
                                    <div class="mobile-user-avatar">
                                        ${user.avatar && user.avatarType === 'image' ? 
                                            `<img src="${user.avatar}" style="width: 35px; height: 35px; border-radius: 50%; object-fit: cover;">` :
                                            `<i class="${user.avatar || 'fas fa-user'}"></i>`
                                        }
                                    </div>
                                    <div class="mobile-user-info">
                                        <div class="mobile-user-name">${user.name || user.username || 'Utente'}</div>
                                        <div class="mobile-user-username">@${user.username || 'user'}</div>
                                    </div>
                                    <div class="mobile-user-actions">
                                        <button class="mobile-follow-btn" onclick="followUser('${user.id}')">Segui</button>
                                        <button class="mobile-message-btn" onclick="openChat('${user.id}')">💬</button>
                                    </div>
                                </div>
                            `).join('');
                        } else {
                            // Fallback to demo users if no real users
                            console.log('📱 No real users, using demo users');
                            const demoUsers = [
                                { id: 1, username: 'marcorossi', name: 'Marco Rossi', email: 'marco@example.com', avatar: 'fas fa-user', avatarType: 'icon', status: 'online' },
                                { id: 2, username: 'sofiatech', name: 'Sofia Tech', email: 'sofia@example.com', avatar: 'fas fa-user', avatarType: 'icon', status: 'online' },
                                { id: 3, username: 'technewsit', name: 'Tech News Italia', email: 'tech@example.com', avatar: 'fas fa-user', avatarType: 'icon', status: 'online' }
                            ];
                            
                            const filteredDemoUsers = demoUsers.filter(user => {
                                const isNotCurrentUser = user.id !== currentUser.id;
                                const isNotCurrentEmail = user.email !== currentUser.email;
                                return isNotCurrentUser && isNotCurrentEmail;
                            });
                            
                            if (filteredDemoUsers.length > 0) {
                                mobileNoUsersMessage.style.display = 'none';
                                mobileUsersList.innerHTML = filteredDemoUsers.map(user => `
                                    <div class="mobile-user-item">
                                        <div class="mobile-user-avatar">
                                            <i class="${user.avatar || 'fas fa-user'}"></i>
                                        </div>
                                        <div class="mobile-user-info">
                                            <div class="mobile-user-name">${user.name || user.username || 'Utente'}</div>
                                            <div class="mobile-user-username">@${user.username || 'user'}</div>
                                        </div>
                                        <div class="mobile-user-actions">
                                            <button class="mobile-follow-btn" onclick="followUser('${user.id}')">Segui</button>
                                            <button class="mobile-message-btn" onclick="openChat('${user.id}')">💬</button>
                                        </div>
                                    </div>
                                `).join('');
                            } else {
                                mobileNoUsersMessage.style.display = 'block';
                                mobileUsersList.innerHTML = '';
                            }
                        }
                    } else {
                        mobileNoUsersMessage.style.display = 'block';
                        mobileUsersList.innerHTML = '';
                    }
                } catch (error) {
                    console.log('📱 Error loading mobile users:', error);
                    mobileNoUsersMessage.style.display = 'block';
                    mobileUsersList.innerHTML = '';
                }
            }
        }
        
        // Make functions global
        window.loadRealUsers = loadRealUsers;
        window.loadMobileUsers = loadMobileUsers;
        window.loadAllPostsForHome = loadAllPostsForHome;
        window.followUser = followUser;
        
        // Messages system
        let messages = [];
        
        // Load messages function
        async function loadMessages() {
            console.log('💬 Loading messages...');
            const messagesList = document.getElementById('messagesList');
            const noMessagesMessage = document.querySelector('.no-messages-message');
            
            if (messagesList) {
                try {
                    // Try to load messages from backend
                    const response = await fetch(`/api/messages/${currentUser.id}`);
                    if (response.ok) {
                        const data = await response.json();
                        messages = data.messages || [];
                        
                        if (messages.length > 0) {
                            noMessagesMessage.style.display = 'none';
                            messagesList.innerHTML = messages.map(message => `
                                <div class="message-item" onclick="openChat('${message.senderId}')">
                                    <div class="message-avatar">
                                        ${message.sender.avatar && message.sender.avatarType === 'image' ? 
                                            `<img src="${message.sender.avatar}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">` :
                                            `<i class="${message.sender.avatar || 'fas fa-user'}"></i>`
                                        }
                                    </div>
                                    <div class="message-info">
                                        <span class="message-name">${message.sender.name}</span>
                                        <span class="message-preview">${message.content}</span>
                                    </div>
                                    <span class="message-time">${formatTime(message.timestamp)}</span>
                                </div>
                            `).join('');
                        } else {
                            noMessagesMessage.style.display = 'block';
                            messagesList.innerHTML = '';
                        }
                    } else {
                        noMessagesMessage.style.display = 'block';
                        messagesList.innerHTML = '';
                    }
                } catch (error) {
                    console.log('💬 Error loading messages:', error);
                    noMessagesMessage.style.display = 'block';
                    messagesList.innerHTML = '';
                }
            }
        }
        
        // Open chat function
        function openChat(userId) {
            console.log('💬 Opening chat with user:', userId);
            showNotification('Funzione chat in sviluppo!', 'info');
        }
        
        // Send message function
        async function sendMessage(recipientId, content) {
            console.log('💬 Sending message to:', recipientId, 'Content:', content);
            try {
                const response = await fetch('/api/messages', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        senderId: currentUser.id,
                        recipientId: recipientId,
                        content: content
                    })
                });
                
                if (response.ok) {
                    showNotification('Messaggio inviato!', 'success');
                    loadMessages(); // Reload messages
                    
                    // Add notification for recipient
                    addNotification('💬 Nuovo Messaggio', 
                        `Hai ricevuto un messaggio da ${currentUser.name}`, 
                        recipientId, 
                        {
                            sender: currentUser.name,
                            message: content,
                            type: 'message'
                        }
                    );
                } else {
                    showNotification('Errore nell\'invio del messaggio', 'error');
                }
            } catch (error) {
                console.log('💬 Error sending message:', error);
                showNotification('Errore nell\'invio del messaggio', 'error');
            }
        }
        
        // Make functions global
        window.loadMessages = loadMessages;
        window.openChat = openChat;
        window.sendMessage = sendMessage;
        
        // Mobile menu functions
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
            
            if (mobileMenu.classList.contains('active')) {
                mobileMenu.classList.remove('active');
                mobileMenuOverlay.classList.remove('active');
            } else {
                mobileMenu.classList.add('active');
                mobileMenuOverlay.classList.add('active');
            }
        }
        
        // Show post modal function
        function showPostModal() {
            // Show the post creation area
            const postArea = document.querySelector('.post-area');
            if (postArea) {
                postArea.scrollIntoView({ behavior: 'smooth' });
                const postText = document.getElementById('postText');
                if (postText) {
                    postText.focus();
                }
            }
        }
        
        // Make mobile functions global
        window.toggleMobileMenu = toggleMobileMenu;
        window.showPostModal = showPostModal;
        
        // Update notification badge
        function updateNotificationBadge() {
            const unreadCount = notifications.filter(n => !n.read).length;
            const badge = document.querySelector('.notification-badge');
            if (badge) {
                badge.textContent = unreadCount;
                badge.style.display = unreadCount > 0 ? 'block' : 'none';
            }
        }
        
        // Load notifications
        function loadNotifications() {
            console.log('🔔 loadNotifications called');
            const notificationsContainer = document.getElementById('notifications-content');
            if (notificationsContainer) {
                console.log('🔔 Total notifications:', notifications.length);
                const unreadNotifications = notifications.filter(n => !n.read);
                console.log('🔔 Unread notifications:', unreadNotifications.length);
                if (unreadNotifications.length === 0) {
                    notificationsContainer.innerHTML = `
                        <p style="color: #71767b; text-align: center; padding: 20px;">Nessuna notifica</p>
                        <button onclick="testNotification()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 10px auto; display: block;">🧪 Test Notifica</button>
                    `;
                } else {
                    notificationsContainer.innerHTML = unreadNotifications.map(notification => {
                        let detailsHtml = '';
                        if (notification.details) {
                            if (notification.details.comment) {
                                detailsHtml += `<div style="color: #007bff; font-size: 14px; margin-top: 8px; padding: 8px; background: #0d1117; border-radius: 5px; border-left: 3px solid #007bff;">
                                    <strong>💬 Commento:</strong> "${notification.details.comment}"
                                </div>`;
                            }
                            if (notification.details.postContent) {
                                detailsHtml += `<div style="color: #28a745; font-size: 14px; margin-top: 8px; padding: 8px; background: #0d1117; border-radius: 5px; border-left: 3px solid #28a745;">
                                    <strong>📝 Post:</strong> "${notification.details.postContent}"
                                </div>`;
                            }
                            if (notification.details.hasMedia) {
                                detailsHtml += `<div style="color: #ffc107; font-size: 14px; margin-top: 8px; padding: 8px; background: #0d1117; border-radius: 5px; border-left: 3px solid #ffc107;">
                                    <strong>📱 Media:</strong> ${notification.details.mediaType || 'Media allegato'}
                                </div>`;
                            }
                        }
                        
                        return `
                            <div class="notification-item" style="background: #1a1a1a; padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 4px solid #007bff;">
                                <div style="color: #fff; font-weight: bold; margin-bottom: 5px;">${notification.type}</div>
                                <div style="color: #ccc;">${notification.message}</div>
                                ${detailsHtml}
                                <div style="color: #71767b; font-size: 12px; margin-top: 5px;">${formatTime(notification.timestamp)}</div>
                            </div>
                        `;
                    }).join('');
                }
            }
        }
        
        // Load explore posts
        async function loadExplorePosts() {
            const explorePostsContainer = document.getElementById('explorePosts');
            if (explorePostsContainer) {
                // Load all posts from database
                await loadAllPostsFromDatabase();
                
                // Render posts in explore section
                explorePostsContainer.innerHTML = '';
                posts.forEach(post => {
                    const postElement = createPostElement(post);
                    explorePostsContainer.appendChild(postElement);
                });
                
                if (posts.length === 0) {
                    explorePostsContainer.innerHTML = '<p style="color: #71767b; text-align: center; padding: 20px;">Nessun post da esplorare</p>';
                }
            }
        }

        // Format time
        function formatTime(timestamp) {
            const now = new Date();
            const diff = now - new Date(timestamp);
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return 'Ora';
            if (minutes < 60) return `${minutes}m`;
            if (hours < 24) return `${hours}h`;
            return `${days}g`;
        }

        // Vote in poll
        function votePoll(postId, optionIndex) {
            const post = posts.find(p => p.id === postId);
            if (post && post.media && post.media.type === 'poll') {
                const poll = post.media.data;
                const userId = currentUser.username;
                
                // Check if user already voted
                if (poll.votes[userId]) {
                    showNotification('Hai già votato in questo sondaggio!');
                    return;
                }
                
                // Record vote
                poll.votes[userId] = optionIndex;
                poll.totalVotes++;
                
                // Save and re-render
                savePosts();
                renderPosts();
                showNotification('Voto registrato!');
            }
        }

        // Delete post
        function deletePost(postId) {
            const post = posts.find(p => p.id === postId);
            if (post) {
                // Check if current user is the owner of the post
                if (!currentUser || !currentUser.id || post.user.id !== currentUser.id) {
                    showNotification('Non hai i permessi per eliminare questo post!');
                    return;
                }
                // Show confirmation modal
                const confirmModal = document.createElement('div');
                confirmModal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                `;
                
                confirmModal.innerHTML = `
                    <div style="background: #1a1a1a; padding: 30px; border-radius: 15px; max-width: 400px; width: 90%; text-align: center;">
                        <h3 style="color: #fff; margin-bottom: 20px;">⚠️ Elimina Post</h3>
                        <p style="color: #ccc; margin-bottom: 25px;">Sei sicuro di voler eliminare questo post? Questa azione non può essere annullata.</p>
                        <div style="display: flex; gap: 15px; justify-content: center;">
                            <button onclick="confirmDeletePost(${postId})" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                                <i class="fas fa-trash"></i> Elimina
                            </button>
                            <button onclick="this.closest('div').parentElement.remove()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                                <i class="fas fa-times"></i> Annulla
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(confirmModal);
            }
        }

        // Confirm delete post
        async function confirmDeletePost(postId) {
            const postIndex = posts.findIndex(p => p.id === postId);
            if (postIndex !== -1) {
                posts.splice(postIndex, 1);
                await savePosts();
                renderPosts();
                showNotification('Post eliminato!');
                document.querySelector('[style*="position: fixed"]').remove();
            }
        }

        // Delete comment
        function deleteComment(postId, commentIndex) {
            const post = posts.find(p => p.id === postId);
            if (post && post.comments[commentIndex]) {
                // Check if current user is the owner of the comment
                const comment = post.comments[commentIndex];
                if (!currentUser || !currentUser.id || comment.user.id !== currentUser.id) {
                    showNotification('Non hai i permessi per eliminare questo commento!');
                    return;
                }
                // Show confirmation modal
                const confirmModal = document.createElement('div');
                confirmModal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                `;
                
                confirmModal.innerHTML = `
                    <div style="background: #1a1a1a; padding: 30px; border-radius: 15px; max-width: 400px; width: 90%; text-align: center;">
                        <h3 style="color: #fff; margin-bottom: 20px;">⚠️ Elimina Commento</h3>
                        <p style="color: #ccc; margin-bottom: 25px;">Sei sicuro di voler eliminare questo commento?</p>
                        <div style="display: flex; gap: 15px; justify-content: center;">
                            <button onclick="confirmDeleteComment(${postId}, ${commentIndex})" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                                <i class="fas fa-trash"></i> Elimina
                            </button>
                            <button onclick="this.closest('div').parentElement.remove()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                                <i class="fas fa-times"></i> Annulla
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(confirmModal);
            }
        }

        // Confirm delete comment
        async function confirmDeleteComment(postId, commentIndex) {
            const post = posts.find(p => p.id === postId);
            if (post && post.comments[commentIndex]) {
                post.comments.splice(commentIndex, 1);
                await savePosts();
                renderPosts();
                showNotification('Commento eliminato!');
                document.querySelector('[style*="position: fixed"]').remove();
            }
        }

        // Update time
        function updateTime() {
            setInterval(() => {
                renderPosts();
            }, 60000);
        }

        // Navigation functions
        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Update active nav item
            const navItems = document.querySelectorAll('.nav-link');
            navItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // Find and activate the clicked nav item
            const clickedNav = event.target.closest('.nav-link');
            if (clickedNav) {
                clickedNav.classList.add('active');
            }
            
            // Update header title
            const header = document.querySelector('.header h1');
            if (header) {
                const titles = {
                    'home': 'Home',
                    'explore': 'Esplora',
                    'notifications': 'Notifiche',
                    'messages': 'Messaggi',
                    'bookmarks': 'Segnalibri',
                    'lists': 'Liste',
                    'profile': 'Profilo',
                    'more': 'Altro'
                };
                header.textContent = titles[sectionName] || 'Connect';
            }
            
            // Load user-specific data for profile section
            if (sectionName === 'profile') {
                loadUserProfileData();
            }
            
            // Load all posts for home section (not just user-specific)
            if (sectionName === 'home') {
                loadAllPostsForHome();
                // Also reload users when going to home
                loadRealUsers();
            }
            
            // Load notifications for notifications section
            if (sectionName === 'notifications') {
                console.log('🔔 Loading notifications section');
                loadNotifications();
            }
            
            // Load messages for messages section
            if (sectionName === 'messages') {
                console.log('💬 Loading messages section');
                loadMessages();
                // Also reload users when going to messages
                loadRealUsers();
            }
            
            // Load all posts for explore section
            if (sectionName === 'explore') {
                loadExplorePosts();
            }
            
            showNotification(`Sezione ${sectionName} attivata!`);
        }
        
        // Load user-specific profile data
        function loadUserProfileData() {
            if (currentUser && currentUser.id) {
                // Update profile info
                const profileName = document.querySelector('.profile-name');
                const profileUsername = document.querySelector('.profile-username');
                const profileBio = document.querySelector('.profile-bio');
                
                if (profileName) profileName.textContent = currentUser.name;
                if (profileUsername) profileUsername.textContent = currentUser.username;
                if (profileBio) profileBio.textContent = currentUser.bio || 'Nessuna biografia disponibile';
                
                // Load user posts by default
                loadUserProfilePosts();
            } else {
                // Show login prompt
                const profilePostsContainer = document.getElementById('profilePosts');
                if (profilePostsContainer) {
                    profilePostsContainer.innerHTML = '<p style="color: #71767b; text-align: center; padding: 20px;">Accedi per vedere il tuo profilo</p>';
                }
            }
        }

        // Show post modal
        function showPostModal() {
            showNotification('Modal di creazione post attivato!');
            // Focus on post textarea
            const postText = document.getElementById('postText');
            if (postText) {
                postText.focus();
            }
        }

        // Profile functions
        async function changeProfilePicture() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = async function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = async function(e) {
                        const avatar = document.querySelector('.profile-avatar');
                        avatar.style.backgroundImage = `url(${e.target.result})`;
                        avatar.style.backgroundSize = 'cover';
                        avatar.style.backgroundPosition = 'center';
                        
                        // Update currentUser avatar
                        currentUser.avatar = e.target.result;
                        currentUser.avatarType = 'image';
                        
                        // Update all post avatars
                        updateAllPostAvatars(e.target.result);
                        
                        // Save to localStorage
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        
                        // Save to backend
                        try {
                            const response = await fetch('/api/user/avatar', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ 
                                    userId: currentUser.id, 
                                    avatar: e.target.result, 
                                    avatarType: 'image' 
                                })
                            });
                            if (response.ok) {
                                console.log('✅ Avatar saved to backend');
                            }
                        } catch (error) {
                            console.log('⚠️ Backend save failed, using localStorage only');
                        }
                        
                        showNotification('Foto profilo aggiornata!', 'success');
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }
        
        // Update all post avatars
        function updateAllPostAvatars(newAvatar) {
            const postAvatars = document.querySelectorAll('.post-avatar');
            postAvatars.forEach(avatar => {
                if (avatar.closest('.post').querySelector('.post-author').textContent === currentUser.name) {
                    avatar.style.backgroundImage = `url(${newAvatar})`;
                    avatar.style.backgroundSize = 'cover';
                    avatar.style.backgroundPosition = 'center';
                }
            });
        }

        function editProfile() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: #1a1a1a; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
                    <h3 style="color: #fff; margin-bottom: 20px;">Modifica Profilo</h3>
                    <div style="margin-bottom: 20px;">
                        <label style="color: #fff; display: block; margin-bottom: 10px;">Nome:</label>
                        <input type="text" id="editName" value="Il Tuo Nome" style="width: 100%; background: #333; border: 1px solid #555; border-radius: 10px; padding: 10px; color: #fff; outline: none;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="color: #fff; display: block; margin-bottom: 10px;">Username:</label>
                        <input type="text" id="editUsername" value="@tuousername" style="width: 100%; background: #333; border: 1px solid #555; border-radius: 10px; padding: 10px; color: #fff; outline: none;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="color: #fff; display: block; margin-bottom: 10px;">Bio:</label>
                        <textarea id="editBio" style="width: 100%; background: #333; border: 1px solid #555; border-radius: 10px; padding: 10px; color: #fff; outline: none; height: 100px;">Bio del profilo - Clicca per modificare</textarea>
                    </div>
                    <div style="display: flex; gap: 15px;">
                        <button onclick="saveProfile()" style="background: #1d9bf0; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; flex: 1;">
                            Salva
                        </button>
                        <button onclick="this.closest('div').parentElement.remove()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                            Annulla
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function saveProfile() {
            const name = document.getElementById('editName').value;
            const username = document.getElementById('editUsername').value;
            const bio = document.getElementById('editBio').value;
            
            document.getElementById('profileName').textContent = name;
            document.getElementById('profileUsername').textContent = username;
            document.getElementById('profileBio').textContent = bio;
            
            showNotification('Profilo aggiornato!');
            document.querySelector('[style*="position: fixed"]').remove();
        }

        function showProfileTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const tabButtons = document.querySelectorAll('.tab-btn');
            tabButtons.forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab
            document.getElementById('profile-' + tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Load user-specific content
            if (tabName === 'posts') {
                loadUserProfilePosts();
            } else if (tabName === 'media') {
                loadUserProfileMedia();
            } else if (tabName === 'likes') {
                loadUserProfileLikes();
            }
        }
        
        // Load user-specific profile posts
        function loadUserProfilePosts() {
            const profilePostsContainer = document.getElementById('profilePosts');
            if (currentUser && currentUser.id) {
                // Show only posts from current user
                const userPosts = posts.filter(post => post.user.id === currentUser.id);
                
                if (userPosts.length === 0) {
                    profilePostsContainer.innerHTML = '<p style="color: #71767b; text-align: center; padding: 20px;">Non hai ancora pubblicato nessun post</p>';
                } else {
                    profilePostsContainer.innerHTML = userPosts.map(post => createPostElement(post).outerHTML).join('');
                }
            } else {
                profilePostsContainer.innerHTML = '<p style="color: #71767b; text-align: center; padding: 20px;">Accedi per vedere i tuoi post</p>';
            }
        }
        
        // Load user-specific profile media
        function loadUserProfileMedia() {
            const profileMediaContainer = document.getElementById('profile-media');
            if (currentUser && currentUser.id) {
                // Show only media from current user
                const userPosts = posts.filter(post => post.user.id === currentUser.id);
                const mediaPosts = userPosts.filter(post => post.media && (post.media.type === 'image' || post.media.type === 'video'));
                
                if (mediaPosts.length === 0) {
                    profileMediaContainer.innerHTML = '<div class="media-grid"><p style="color: #71767b; text-align: center; padding: 20px;">Non hai ancora condiviso nessun media</p></div>';
                } else {
                    profileMediaContainer.innerHTML = `
                        <div class="media-grid">
                            ${mediaPosts.map(post => `
                                <div class="media-item" onclick="showPostModal(${post.id})">
                                    ${post.media.type === 'image' ? 
                                        `<img src="${post.media.url}" alt="Media" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">` :
                                        `<video src="${post.media.url}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;"></video>`
                                    }
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            } else {
                profileMediaContainer.innerHTML = '<div class="media-grid"><p style="color: #71767b; text-align: center; padding: 20px;">Accedi per vedere i tuoi media</p></div>';
            }
        }
        
        // Load user-specific profile likes
        function loadUserProfileLikes() {
            const profileLikesContainer = document.getElementById('profile-likes');
            if (currentUser && currentUser.id) {
                // Show only liked posts from current user
                const likedPosts = posts.filter(post => post.liked && post.user.id === currentUser.id);
                
                if (likedPosts.length === 0) {
                    profileLikesContainer.innerHTML = '<div class="liked-posts"><p style="color: #71767b; text-align: center; padding: 20px;">Non hai ancora messo like a nessun post</p></div>';
                } else {
                    profileLikesContainer.innerHTML = `
                        <div class="liked-posts">
                            ${likedPosts.map(post => createPostElement(post).outerHTML).join('')}
                        </div>
                    `;
                }
            } else {
                profileLikesContainer.innerHTML = '<div class="liked-posts"><p style="color: #71767b; text-align: center; padding: 20px;">Accedi per vedere i tuoi like</p></div>';
            }
        }

        // Settings functions
        function showSettings() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: #1a1a1a; padding: 30px; border-radius: 15px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <h3 style="color: #fff; margin-bottom: 20px;">Impostazioni</h3>
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #fff; margin-bottom: 10px;">Account</h4>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #333; border-radius: 10px; margin-bottom: 10px;">
                            <span style="color: #fff;">Email</span>
                            <span style="color: #71767b;">user@example.com</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #333; border-radius: 10px;">
                            <span style="color: #fff;">Password</span>
                            <button style="background: #1d9bf0; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer;">Cambia</button>
                        </div>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #fff; margin-bottom: 10px;">Privacy</h4>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #333; border-radius: 10px; margin-bottom: 10px;">
                            <span style="color: #fff;">Profilo pubblico</span>
                            <input type="checkbox" checked style="transform: scale(1.2);">
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #333; border-radius: 10px;">
                            <span style="color: #fff;">Mostra email</span>
                            <input type="checkbox" style="transform: scale(1.2);">
                        </div>
                    </div>
                    <button onclick="this.closest('div').parentElement.remove()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; width: 100%;">
                        Chiudi
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function showHelp() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: #1a1a1a; padding: 30px; border-radius: 15px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <h3 style="color: #fff; margin-bottom: 20px;">Aiuto e Supporto</h3>
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #fff; margin-bottom: 15px;">Come iniziare</h4>
                        <div style="color: #ccc; line-height: 1.6;">
                            <p>• <strong>Crea un post:</strong> Clicca su "Posta" e scrivi il tuo pensiero</p>
                            <p>• <strong>Aggiungi media:</strong> Usa i pulsanti per foto, video, GIF e sondaggi</p>
                            <p>• <strong>Interagisci:</strong> Metti like, commenta e condividi i post</p>
                            <p>• <strong>Naviga:</strong> Usa il menu laterale per esplorare le diverse sezioni</p>
                        </div>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #fff; margin-bottom: 15px;">Funzionalità principali</h4>
                        <div style="color: #ccc; line-height: 1.6;">
                            <p>• <strong>Home:</strong> Feed principale con tutti i post</p>
                            <p>• <strong>Esplora:</strong> Scopri tendenze e hashtag</p>
                            <p>• <strong>Notifiche:</strong> Vedi le attività dei tuoi contatti</p>
                            <p>• <strong>Messaggi:</strong> Chat privata con altri utenti</p>
                            <p>• <strong>Profilo:</strong> Gestisci le tue informazioni</p>
                        </div>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #fff; margin-bottom: 15px;">Contatti</h4>
                        <div style="color: #ccc; line-height: 1.6;">
                            <p>📧 Email: support@connect.com</p>
                            <p>📱 Telefono: +39 123 456 7890</p>
                            <p>💬 Chat: Disponibile 24/7</p>
                        </div>
                    </div>
                    <button onclick="this.closest('div').parentElement.remove()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; width: 100%;">
                        Chiudi
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function showAbout() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: #1a1a1a; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%; text-align: center;">
                    <div style="margin-bottom: 20px;">
                        <div style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(45deg, #ff00ff, #ff1493); display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; font-weight: bold; margin: 0 auto 20px;">C</div>
                        <h3 style="color: #fff; margin-bottom: 10px;">Connect</h3>
                        <p style="color: #71767b;">Versione 1.0.0</p>
                    </div>
                    <div style="color: #ccc; line-height: 1.6; margin-bottom: 20px;">
                        <p>Connect è il social network moderno che ti permette di condividere pensieri, foto, video e molto altro con la tua comunità.</p>
                        <p>Costruito con tecnologie all'avanguardia per offrirti la migliore esperienza possibile.</p>
                    </div>
                    <div style="color: #71767b; font-size: 0.9rem; margin-bottom: 20px;">
                        <p>© 2024 Connect. Tutti i diritti riservati.</p>
                    </div>
                    <button onclick="this.closest('div').parentElement.remove()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                        Chiudi
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Show delete account modal
        function showDeleteAccount() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: #1a1a1a; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
                    <h3 style="color: #dc3545; margin-bottom: 20px;">🗑️ Elimina Account</h3>
                    <div style="color: #fff; margin-bottom: 20px;">
                        <p style="margin-bottom: 15px;">Sei sicuro di voler eliminare il tuo account?</p>
                        <p style="color: #dc3545; font-weight: bold;">⚠️ Questa azione non può essere annullata!</p>
                        <p style="color: #71767b; font-size: 0.9rem; margin-top: 10px;">
                            Verranno eliminati:
                            <br>• Il tuo profilo e tutti i dati
                            <br>• Tutti i tuoi post e commenti
                            <br>• I tuoi follower e following
                            <br>• Tutte le tue notifiche
                        </p>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="color: #fff; display: block; margin-bottom: 10px;">Motivo dell'eliminazione:</label>
                        <select id="deleteReason" style="width: 100%; background: #333; border: 1px solid #555; border-radius: 10px; padding: 10px; color: #fff; outline: none;">
                            <option value="">Seleziona un motivo</option>
                            <option value="privacy">Problemi di privacy</option>
                            <option value="spam">Troppo spam</option>
                            <option value="not_useful">Non è utile</option>
                            <option value="technical_issues">Problemi tecnici</option>
                            <option value="other">Altro</option>
                        </select>
                    </div>
                    <div id="customReasonDiv" style="margin-bottom: 20px; display: none;">
                        <label style="color: #fff; display: block; margin-bottom: 10px;">Specifica il motivo:</label>
                        <textarea id="customReason" placeholder="Descrivi il motivo..." style="width: 100%; background: #333; border: 1px solid #555; border-radius: 10px; padding: 10px; color: #fff; outline: none; height: 80px;"></textarea>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="color: #fff; display: block; margin-bottom: 10px;">Conferma con la tua password:</label>
                        <input type="password" id="deletePassword" placeholder="Inserisci la tua password" style="width: 100%; background: #333; border: 1px solid #555; border-radius: 10px; padding: 10px; color: #fff; outline: none;">
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="confirmDeleteAccount()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; flex: 1;">
                            🗑️ Elimina Definitivamente
                        </button>
                        <button onclick="this.closest('div').parentElement.remove()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                            Annulla
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Show custom reason field when "other" is selected
            document.getElementById('deleteReason').addEventListener('change', function() {
                const customDiv = document.getElementById('customReasonDiv');
                if (this.value === 'other') {
                    customDiv.style.display = 'block';
                } else {
                    customDiv.style.display = 'none';
                }
            });
        }

        // Confirm delete account
        async function confirmDeleteAccount() {
            const reason = document.getElementById('deleteReason').value;
            const customReason = document.getElementById('customReason').value;
            const password = document.getElementById('deletePassword').value;
            
            if (!reason) {
                showNotification('Seleziona un motivo per l\'eliminazione', 'error');
                return;
            }
            
            if (reason === 'other' && !customReason.trim()) {
                showNotification('Specifica il motivo personalizzato', 'error');
                return;
            }
            
            if (!password) {
                showNotification('Inserisci la password per confermare', 'error');
                return;
            }
            
            const finalReason = reason === 'other' ? customReason : reason;
            
            if (!confirm(`Sei ASSOLUTAMENTE sicuro di voler eliminare il tuo account?\n\nMotivo: ${finalReason}\n\nQuesta azione è IRREVERSIBILE!`)) {
                return;
            }
            
            try {
                const response = await fetch('/api/auth/delete-account', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('auth_token') || 'demo-token'}`
                    },
                    body: JSON.stringify({
                        password: password,
                        reason: finalReason
                    })
                });
                
                if (response.ok) {
                    showNotification('Account eliminato con successo', 'success');
                    
                    // Logout e redirect
                    localStorage.removeItem('currentUser');
                    localStorage.removeItem('auth_token');
                    currentUser = null;
                    isAuthenticated = false;
                    posts = [];
                    
                    // Show login modal
                    document.getElementById('authModal').style.display = 'flex';
                    document.getElementById('mainApp').style.display = 'none';
                    
                    // Close modal
                    document.querySelector('[style*="position: fixed"]').remove();
                } else {
                    const error = await response.json();
                    showNotification('Errore: ' + error.message, 'error');
                }
            } catch (error) {
                console.error('Delete account error:', error);
                showNotification('Errore nell\'eliminazione dell\'account', 'error');
            }
        }

        // Authentication functions
        let isAuthenticated = false;

        // Check if user is already logged in
        function checkAuth() {
            console.log('🔐 Checking authentication...');
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                console.log('✅ User found in localStorage');
                currentUser = JSON.parse(savedUser);
                isAuthenticated = true;
                
                // Update profile avatar if user has one
                if (currentUser.avatar && currentUser.avatarType === 'image') {
                    const profileAvatar = document.querySelector('.profile-avatar');
                    if (profileAvatar) {
                        profileAvatar.style.backgroundImage = `url(${currentUser.avatar})`;
                        profileAvatar.style.backgroundSize = 'cover';
                        profileAvatar.style.backgroundPosition = 'center';
                    }
                }
                
                // Load all posts for home feed (GLOBAL - from all users)
                loadAllPostsForHome();
                
                // Load user profile data
                loadUserProfileData();
                
                showMainApp();
            } else {
                // User not authenticated, show auth modal
                console.log('❌ User not authenticated, showing auth modal');
                console.log('🔍 Auth modal element:', document.getElementById('authModal'));
                showAuthModal();
            }
        }

        // Show main app
        function showMainApp() {
            const authModal = document.getElementById('authModal');
            const mainApp = document.getElementById('mainApp');
            if (authModal) authModal.style.display = 'none';
            if (mainApp) mainApp.style.display = 'grid';
            document.getElementById('mainApp').classList.add('show');
            
            // Update profile info if user is logged in
            if (currentUser) {
                document.getElementById('profileName').textContent = currentUser.name;
                document.getElementById('profileUsername').textContent = '@' + currentUser.username;
            }
            
            // Load real users when app starts
            loadRealUsers();
            
            // Reload users every 30 seconds to catch new registrations
            setInterval(() => {
                console.log('🔄 Auto-reloading users...');
                loadRealUsers();
            }, 30000);
        }

        // Show auth modal
        function showAuthModal() {
            console.log('🔐 showAuthModal called');
            const authModal = document.getElementById('authModal');
            const mainApp = document.getElementById('mainApp');
            
            console.log('🔍 Auth modal element:', authModal);
            console.log('🔍 Main app element:', mainApp);
            
            if (authModal) {
                authModal.style.display = 'flex';
                console.log('✅ Auth modal shown with display: flex');
                console.log('🔍 Auth modal computed style:', window.getComputedStyle(authModal).display);
            } else {
                console.error('❌ Auth modal element not found!');
            }
            
            if (mainApp) {
                mainApp.style.display = 'none';
                console.log('✅ Main app hidden');
            }
        }

        // Show login form
        function showLogin() {
            console.log('showLogin called');
            document.getElementById('loginForm').classList.add('active');
            document.getElementById('registerForm').classList.remove('active');
            document.getElementById('forgotPasswordForm').classList.remove('active');
            showNotification('Form di login attivato!');
        }

        // Show register form
        function showRegister() {
            console.log('showRegister called');
            document.getElementById('registerForm').classList.add('active');
            document.getElementById('loginForm').classList.remove('active');
            document.getElementById('forgotPasswordForm').classList.remove('active');
            showNotification('Form di registrazione attivato!');
        }

        // Show forgot password form
        function showForgotPassword() {
            console.log('showForgotPassword called');
            document.getElementById('forgotPasswordForm').classList.add('active');
            document.getElementById('loginForm').classList.remove('active');
            document.getElementById('registerForm').classList.remove('active');
            showNotification('Form password dimenticata attivato!');
        }

        // Handle login
        async function handleLogin(event) {
            console.log('handleLogin called');
            event.preventDefault();
            
            // Prevent form from disappearing
            const loginForm = document.getElementById('loginForm');
            const loginFormElement = document.getElementById('loginFormElement');
            const loginButton = loginForm.querySelector('button[type="submit"]');
            
            // Prevent form reset
            if (loginFormElement) {
                loginFormElement.style.pointerEvents = 'none';
            }
            
            // Show loading state
            if (loginButton) {
                loginButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Accedendo...';
                loginButton.disabled = true;
            }
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            console.log('Login attempt:', { email, password: '***', rememberMe });
            
            try {
                console.log('📱 Mobile login attempt:', { email, password: '***' });
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });
                
                console.log('📱 Mobile login response status:', response.status);
                console.log('📱 Mobile login response ok:', response.ok);
                
                const data = await response.json();
                console.log('📱 Mobile login response data:', data);
                
                if (data.token && data.user) {
                    // Use real user data from backend
                    currentUser = {
                        id: data.user.id,
                        name: data.user.name,
                        username: data.user.username,
                        email: data.user.email,
                        avatar: data.user.avatar || "fas fa-user",
                        avatarType: data.user.avatar ? "image" : "icon",
                        online: true
                    };
                    
                    isAuthenticated = true;
                    
                    // Save user data
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    // Load all posts for home feed (GLOBAL - from all users)
                    loadAllPostsForHome();
                    
                    showNotification('Login effettuato con successo!');
                    showMainApp();
                } else {
                    showNotification('Errore: ' + data.message);
                    // Restore button and form
                    if (loginButton) {
                        loginButton.innerHTML = '<i class="fas fa-sign-in-alt"></i> Accedi';
                        loginButton.disabled = false;
                    }
                    if (loginFormElement) {
                        loginFormElement.style.pointerEvents = 'auto';
                    }
                }
            } catch (error) {
                console.error('📱 Mobile login error:', error);
                console.log('📱 Mobile login fallback activated');
                
                // Restore button and form on error
                if (loginButton) {
                    loginButton.innerHTML = '<i class="fas fa-sign-in-alt"></i> Accedi';
                    loginButton.disabled = false;
                }
                if (loginFormElement) {
                    loginFormElement.style.pointerEvents = 'auto';
                }
                // Fallback for demo purposes
                currentUser = {
                    id: btoa(email).replace(/[^a-zA-Z0-9]/g, ''),
                    name: email === 'fabio.cavalieri@libero.it' ? 'Fabio' : email.split('@')[0].charAt(0).toUpperCase() + email.split('@')[0].slice(1),
                    username: email === 'fabio.cavalieri@libero.it' ? 'fabio75' : email.split('@')[0],
                    email: email,
                    avatar: 'fas fa-user',
                    avatarType: 'icon'
                };
                isAuthenticated = true;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                    // Load all posts for home feed (GLOBAL - from all users)
                    loadAllPostsForHome();
                    
                    // Restore button and form on success
                    if (loginButton) {
                        loginButton.innerHTML = '<i class="fas fa-sign-in-alt"></i> Accedi';
                        loginButton.disabled = false;
                    }
                    if (loginFormElement) {
                        loginFormElement.style.pointerEvents = 'auto';
                    }
                    
                    showNotification('Login demo effettuato!');
                    showMainApp();
            }
        }

        // Handle register
        async function handleRegister(event) {
            console.log('handleRegister called');
            event.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const acceptTerms = document.getElementById('acceptTerms').checked;
            
            console.log('Register attempt:', { name, username, email, password: '***', confirmPassword: '***', acceptTerms });
            
            if (password !== confirmPassword) {
                showNotification('Le password non coincidono!');
                return;
            }
            
            if (!acceptTerms) {
                showNotification('Devi accettare i Termini di Servizio!');
                return;
            }
            
            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name, username, email, password })
                });
                
                const data = await response.json();
                
                if (data.token && data.user) {
                    // Use real user data from backend
                    currentUser = {
                        id: data.user.id,
                        name: data.user.name,
                        username: data.user.username,
                        email: data.user.email,
                        avatar: data.user.avatar || "fas fa-user",
                        avatarType: data.user.avatar ? "image" : "icon",
                        online: true
                    };
                    
                    isAuthenticated = true;
                    
                    // Save user data
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    // Load all posts for home feed (GLOBAL - from all users)
                    loadAllPostsForHome();
                    
                    showNotification('Registrazione effettuata con successo!');
                    showMainApp();
                } else {
                    showNotification('Errore: ' + data.message);
                }
            } catch (error) {
                console.error('Register error:', error);
                // Fallback for demo purposes
                currentUser = {
                    id: btoa(email).replace(/[^a-zA-Z0-9]/g, ''),
                    name: name || 'Fabio',
                    username: username || 'fabio75',
                    email: email,
                    avatar: 'fas fa-user',
                    avatarType: 'icon'
                };
                isAuthenticated = true;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Load all posts for home feed (GLOBAL - from all users)
                loadAllPostsForHome();
                
                showNotification('Registrazione demo effettuata!');
                showMainApp();
            }
        }

        // Handle forgot password
        async function handleForgotPassword(event) {
            event.preventDefault();
            
            const email = document.getElementById('forgotEmail').value;
            
            try {
                const response = await fetch('/api/forgot-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Email di reset inviata!');
                    showLogin();
                } else {
                    showNotification('Errore: ' + data.message);
                }
            } catch (error) {
                console.error('Forgot password error:', error);
                showNotification('Email di reset demo inviata!');
                showLogin();
            }
        }

        // Logout function
        function logout() {
            currentUser = null;
            isAuthenticated = false;
            localStorage.removeItem('currentUser');
            
            // Clear posts array
            posts = [];
            
            document.getElementById('authModal').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('mainApp').classList.remove('show');
            showNotification('Logout effettuato!');
        }

        // Update logout function in more section
        function showLogout() { 
            if (confirm('Sei sicuro di voler uscire?')) {
                logout();
            }
        }

        // Other functions
        function showPrivacy() { 
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000;';
            modal.innerHTML = '<div style="background: #1a1a1a; padding: 30px; border-radius: 15px; max-width: 600px; width: 90%;"><h3 style="color: #fff; margin-bottom: 20px;">Privacy e Sicurezza</h3><div style="margin-bottom: 20px;"><h4 style="color: #fff; margin-bottom: 10px;">Impostazioni Privacy</h4><div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #333; border-radius: 10px; margin-bottom: 10px;"><span style="color: #fff;">Profilo pubblico</span><input type="checkbox" checked style="transform: scale(1.2);"></div><div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #333; border-radius: 10px; margin-bottom: 10px;"><span style="color: #fff;">Mostra email</span><input type="checkbox" style="transform: scale(1.2);"></div><div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #333; border-radius: 10px;"><span style="color: #fff;">Mostra online</span><input type="checkbox" checked style="transform: scale(1.2);"></div></div><button onclick="this.closest(\'div\').parentElement.remove()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; width: 100%;">Chiudi</button></div>';
            document.body.appendChild(modal);
        }
        function showNotifications() { 
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000;';
            modal.innerHTML = '<div style="background: #1a1a1a; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;"><h3 style="color: #fff; margin-bottom: 20px;">Impostazioni Notifiche</h3><div style="margin-bottom: 20px;"><div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #333; border-radius: 10px; margin-bottom: 10px;"><span style="color: #fff;">Notifiche push</span><input type="checkbox" checked style="transform: scale(1.2);"></div><div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #333; border-radius: 10px; margin-bottom: 10px;"><span style="color: #fff;">Notifiche email</span><input type="checkbox" checked style="transform: scale(1.2);"></div><div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #333; border-radius: 10px;"><span style="color: #fff;">Notifiche SMS</span><input type="checkbox" style="transform: scale(1.2);"></div></div><button onclick="this.closest(\'div\').parentElement.remove()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; width: 100%;">Chiudi</button></div>';
            document.body.appendChild(modal);
        }
        function showContact() { 
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000;';
            modal.innerHTML = '<div style="background: #1a1a1a; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%; text-align: center;"><h3 style="color: #fff; margin-bottom: 20px;">Contattaci</h3><div style="color: #ccc; line-height: 1.6; margin-bottom: 20px;"><p>📧 Email: support@connect.com</p><p>📱 Telefono: +39 389.5009266</p><p>💬 Chat: Disponibile 24/7</p><p>🌐 Sito: fabiocavalieri.it</p></div><button onclick="this.closest(\'div\').parentElement.remove()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">Chiudi</button></div>';
            document.body.appendChild(modal);
        }
        function showReport() { 
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000;';
            modal.innerHTML = '<div style="background: #1a1a1a; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;"><h3 style="color: #fff; margin-bottom: 20px;">Segnala un Problema</h3><div style="margin-bottom: 20px;"><label style="color: #fff; display: block; margin-bottom: 10px;">Tipo di problema:</label><select style="width: 100%; background: #333; border: 1px solid #555; border-radius: 10px; padding: 10px; color: #fff; outline: none;"><option>Bug tecnico</option><option>Contenuto inappropriato</option><option>Spam</option><option>Altro</option></select></div><div style="margin-bottom: 20px;"><label style="color: #fff; display: block; margin-bottom: 10px;">Descrizione:</label><textarea style="width: 100%; background: #333; border: 1px solid #555; border-radius: 10px; padding: 10px; color: #fff; outline: none; height: 100px;" placeholder="Descrivi il problema..."></textarea></div><div style="display: flex; gap: 15px;"><button onclick="this.closest(\'div\').parentElement.remove()" style="background: #1d9bf0; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; flex: 1;">Invia</button><button onclick="this.closest(\'div\').parentElement.remove()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">Annulla</button></div></div>';
            document.body.appendChild(modal);
        }
        function showTerms() { 
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000;';
            modal.innerHTML = '<div style="background: #1a1a1a; padding: 30px; border-radius: 15px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto;"><h3 style="color: #fff; margin-bottom: 20px;">Termini di Servizio</h3><div style="color: #ccc; line-height: 1.6; margin-bottom: 20px;"><h4 style="color: #fff; margin-bottom: 15px;">1. Accettazione dei Termini</h4><p>Utilizzando Connect, accetti di rispettare questi termini di servizio.</p><h4 style="color: #fff; margin-bottom: 15px;">2. Uso del Servizio</h4><p>Non puoi utilizzare Connect per attività illegali o dannose.</p><h4 style="color: #fff; margin-bottom: 15px;">3. Contenuti</h4><p>Sei responsabile dei contenuti che pubblichi su Connect.</p><h4 style="color: #fff; margin-bottom: 15px;">4. Privacy</h4><p>Rispettiamo la tua privacy e proteggiamo i tuoi dati.</p></div><button onclick="this.closest(\'div\').parentElement.remove()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; width: 100%;">Chiudi</button></div>';
            document.body.appendChild(modal);
        }
        function showPrivacyPolicy() { 
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000;';
            modal.innerHTML = '<div style="background: #1a1a1a; padding: 30px; border-radius: 15px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto;"><h3 style="color: #fff; margin-bottom: 20px;">Privacy Policy</h3><div style="color: #ccc; line-height: 1.6; margin-bottom: 20px;"><h4 style="color: #fff; margin-bottom: 15px;">Raccolta Dati</h4><p>Raccogliamo solo i dati necessari per fornire il servizio.</p><h4 style="color: #fff; margin-bottom: 15px;">Uso dei Dati</h4><p>I tuoi dati sono utilizzati solo per migliorare la tua esperienza su Connect.</p><h4 style="color: #fff; margin-bottom: 15px;">Condivisione</h4><p>Non condividiamo i tuoi dati con terze parti senza il tuo consenso.</p><h4 style="color: #fff; margin-bottom: 15px;">Sicurezza</h4><p>Utilizziamo le migliori pratiche di sicurezza per proteggere i tuoi dati.</p></div><button onclick="this.closest(\'div\').parentElement.remove()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; width: 100%;">Chiudi</button></div>';
            document.body.appendChild(modal);
        }

        // Global debug function
        window.debugAuth = function() {
            console.log('Debug Auth Functions:');
            console.log('showLogin:', typeof showLogin);
            console.log('showRegister:', typeof showRegister);
            console.log('showForgotPassword:', typeof showForgotPassword);
            console.log('handleLogin:', typeof handleLogin);
            console.log('handleRegister:', typeof handleRegister);
        };

        // Test connection function for mobile
        window.testConnection = async function() {
            console.log('📱 Testing mobile connection...');
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                console.log('📱 Mobile connection test:', data);
                showNotification('Connessione OK: ' + data.message);
                return true;
            } catch (error) {
                console.error('📱 Mobile connection test failed:', error);
                showNotification('Errore connessione: ' + error.message);
                return false;
            }
        };
        
        // Make functions globally accessible
        window.showAuthModal = showAuthModal;
        window.showLogin = showLogin;
        window.showRegister = showRegister;
        window.showForgotPassword = showForgotPassword;
        window.handleLogin = handleLogin;
        window.handleRegister = handleRegister;
        
        // Debug function
        window.debugModal = function() {
            const authModal = document.getElementById('authModal');
            const mainApp = document.getElementById('mainApp');
            console.log('🔍 Debug Modal:');
            console.log('Auth modal element:', authModal);
            console.log('Auth modal display:', authModal ? authModal.style.display : 'not found');
            console.log('Auth modal computed display:', authModal ? window.getComputedStyle(authModal).display : 'not found');
            console.log('Main app element:', mainApp);
            console.log('Main app display:', mainApp ? mainApp.style.display : 'not found');
            console.log('Main app computed display:', mainApp ? window.getComputedStyle(mainApp).display : 'not found');
        };
        window.handleForgotPassword = handleForgotPassword;
        window.addComment = addComment;
        window.handleCommentKeypress = handleCommentKeypress;
        window.showPrivacy = showPrivacy;
        window.showNotifications = showNotifications;
        window.showContact = showContact;
        window.showReport = showReport;
        window.showTerms = showTerms;
        window.showPrivacyPolicy = showPrivacyPolicy;
        window.showDeleteAccount = showDeleteAccount;
        window.confirmDeleteAccount = confirmDeleteAccount;
        window.changeProfilePicture = changeProfilePicture;
        window.updateAllPostAvatars = updateAllPostAvatars;
        window.handleSearchKeypress = handleSearchKeypress;
        window.performSearch = performSearch;
        window.searchPosts = searchPosts;
        window.searchUsers = searchUsers;
        window.searchHashtags = searchHashtags;
        window.showSearchTab = showSearchTab;
        window.loadUserProfilePosts = loadUserProfilePosts;
        window.loadUserProfileMedia = loadUserProfileMedia;
        window.loadUserProfileLikes = loadUserProfileLikes;
        window.loadUserProfileData = loadUserProfileData;
        
        // Test global functions
        console.log('Global functions set:', {
            showLogin: typeof window.showLogin,
            showRegister: typeof window.showRegister,
            handleLogin: typeof window.handleLogin,
            handleRegister: typeof window.handleRegister
        });
    </script>
</body>
</html>